<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core">
  <h:body>

    <ui:composition template="/templates/master.xhtml">
      <ui:param name="title" value="Job List" />
      <ui:define name="content">
        <h:form>
          <h3>
            <h:outputText value="Resources" />
          </h3>
          <h:outputText value="Add new resource: " />
          <h:commandLink styleClass="navigation" value="OAI-PMH"
                         action="#{resourceController.prepareOaiPmhResourceToAdd}" />
          <h:outputText value=", " />
          <h:commandLink styleClass="navigation" value="XML/MARC bulk"
                         action="#{resourceController.prepareXmlBulkResourceToAdd}" />
          <h:outputText value=", "/>
          <h:commandLink styleClass="navigation" value="Connector" 
                         action="#{resourceController.prepareConnectorResourceToAdd}" />       
          <h:outputText value=", "/>
          <h:commandLink styleClass="navigation" value="WebCrawl" 
                         action="#{resourceController.prepareWebCrawlResourceToAdd}" />       
        </h:form>
        <h:form>
          <div id="pager">
            <h:outputText
              value="Item #{resourceController.firstItem + 1}..#{resourceController.lastItem} of #{resourceController.itemCount}" />
            &nbsp;
            <h:commandLink action="#{resourceController.prev}"
                           value="Previous"
                           rendered="#{resourceController.firstItem &gt;= resourceController.batchSize}" />
            &nbsp;
            <h:commandLink action="#{resourceController.next}"
                           value="Next"
                           rendered="#{resourceController.lastItem  &lt; resourceController.itemCount}" />
          </div>
          <h:dataTable width="100%" value="#{resourceController.resources}"
                       var="item"
                       columnClasses="resourcename,status,lastharvest,nextharvest,actions,statusmessage">
            <h:column>
              <f:facet name="header">
                <h:outputText value="Name" />
              </f:facet>
              <h:outputText value="#{item.name}"></h:outputText>
            </h:column>
            <h:column>
              <f:facet name="header">
                <h:outputText value="Status" />
              </f:facet>
              <h:outputText value="#{item.currentStatus}"></h:outputText>
            </h:column>
            <h:column>
              <f:facet name="header">
                <h:outputText value="Last Harvested" />
              </f:facet>
              <h:outputText rendered="#{item.lastHarvestFinished != null}"
                            value="#{item.lastHarvestFinished}">
                <f:convertDateTime pattern="yyyy-MM-dd HH:mm z" />
              </h:outputText>
              <h:outputText styleClass="attempt"
                            rendered="#{item.lastHarvestFinished == null}"
                            value="#{item.lastHarvestStarted}">
                <f:convertDateTime pattern="yyyy-MM-dd HH:mm z" />
              </h:outputText>
            </h:column>
            <h:column>
              <f:facet name="header">
                <h:outputText value="Next Scheduled Harvest" />
              </f:facet>
              <h:outputText rendered="#{item.enabled}"
                            value="#{item.nextHarvestSchedule}">
                <f:convertDateTime pattern="yyyy-MM-dd HH:mm z" />
              </h:outputText>
              <h:outputText rendered="#{!item.enabled }"
                            value="Disabled">
              </h:outputText>
            </h:column>
            <h:column>
              <f:facet name="header">
                <h:outputText value="Actions" />
              </f:facet>
              <h:commandLink styleClass="action"
                             action="#{resourceController.prepareResourceToEdit}">
                <f:param name="resourceId" value="#{item.id}" />
                <h:graphicImage title="Edit" alt="Edit" height="16" url="/images/edit.png" />
              </h:commandLink>
              <h:commandLink styleClass="action"
                             action="#{resourceController.prepareResourceToRun}">
                <f:param name="resourceId" value="#{item.id}" />
                <h:graphicImage title="Run" alt="Run" height="16" url="/images/run.png" />
              </h:commandLink>
              <h:commandLink styleClass="action"
                             action="#{resourceController.deleteResource}"
                             onclick="return confirm('Are you sure?');">
                <f:param name="resourceId" value="#{item.id}" />
                <h:graphicImage title="Delete" alt="Delete" height="16" url="/images/delete.png" />
              </h:commandLink>
              <h:commandLink styleClass="action"
                             action="#{resourceController.viewJobLog}">
                <f:param name="resourceId" value="#{item.id}" />
                <h:graphicImage title="View Log" alt="View Log" height="16" url="/images/log.png" />
              </h:commandLink>
            </h:column>
            <h:column>
              <f:facet name="header">
                <h:outputText value="Status Message" />
              </f:facet>
              <h:outputText value="#{item.message}"></h:outputText>
            </h:column>
          </h:dataTable>
        </h:form>
      </ui:define>
    </ui:composition>

  </h:body>

</html>