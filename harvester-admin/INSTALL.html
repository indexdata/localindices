<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>QuickSearch Deployment Notes</title>
	<meta name="generator" content="BBEdit 9.5" />
	<style type="text/css" title="text/css">
/* <![CDATA[ */
.code { font-family: monospace; }
span.code:before { content:"`" }
span.code:after { content:"`" }
pre.code
{
	margin-left: 2em;
}
/* ]]> */
	</style>

</head>
<body>
<h1>Harvester Installation Notes</h1>

<h2>Add Index Data YUM Repositories</h2>
<p>
To add the repository to the server put the following lines in a file
called 'indexdata.repo' under '/etc/yum.repo.d/' (procedure is quite
similar to Debian's apt-get configuration):
</p>
<pre class="code">[indexdata-main]
name=Index Data Main Repository
baseurl=http://ftp.indexdata.com/pub/yum/centos/5.5/main/$basearch
failovermethod=priority
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-indexdata
enabled=0
priority=12

[indexdata-restricted]
name=Index Data Restricted Repository
baseurl=http://ftp.indexdata.com/pub/yum/centos/5.5/restricted/$basearch
failovermethod=priority
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-indexdata
enabled=0
priority=12</pre>
<p>
Now import the ID's GPG key used to sign the packages:
</p>
<pre class="code">wget http://ftp.indexdata.com/pub/debian/indexdata.asc
sudo cp indexdata.asc /etc/pki/rpm-gpg/RPM-GPG-KEY-indexdata</pre>

<h2>Install Index Data packages</h2>
<p>
Since ID repository is disabled by default (<i>enabled=0</i>), ID packages
are ignored in any  YUM invocation, that also includes the default system 
update process (<i>yum upgrade</i>).
In order to enable the ID repository the <i>--enablerepo=indexdata*</i> flag
needs to be passed to <b>ALL</b> yum commands in order to include ID packages 
in YUM execution.
</p>

Install the MasterKey packages:
<pre class="code">
yum install masterkey-harvester masterkey-harvester-admin masterkey-harvester-admin-tomcat masterkey-harvester-tomcat6 masterkey-harvester-admin-tomcat6 --enablerepo=indexdata*
</pre>

<h2>MySQL server</h2>
The harvester uses a mysql database for configuration storage. The Server does not have to local but as default is: 
<pre class="code">
yum install mysql-server
</pre>

Create a database 'localindices' as mysql admin and give a localidxadm user all rights on this database: 

<pre>
mysql -u root -p admin-password 
mysql> create  database localindices
mysql> grant all on localindices.* to 'localidxadm'@'localhost' identified by 'localidxadmpass'; 
mysql> flush privileges;
</pre>

Configuration of the database/user/password are in the context of the web applications:
<pre>
/usr/share/masterkey/harvester/META-INF/context.xml
/usr/share/masterkey/harvester-admin/META-INF/context.xml 
</pre>

Import the follow database schema into the database:
<pre>
-- MySQL dump 10.13  Distrib 5.5.12, for osx10.6 (i386)
--
-- Host: localhost    Database: localindices
-- ------------------------------------------------------
-- Server version   5.5.12

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `HARVESTABLE`
--

DROP TABLE IF EXISTS `HARVESTABLE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `HARVESTABLE` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `LASTUPDATED` datetime DEFAULT NULL,
  `DESCRIPTION` varchar(4096) DEFAULT NULL,
  `INITIALLYHARVESTED` datetime DEFAULT NULL,
  `TECHNICALNOTES` varchar(4096) DEFAULT NULL,
  `LASTHARVESTSTARTED` datetime DEFAULT NULL,
  `SCHEDULESTRING` varchar(255) DEFAULT NULL,
  `LASTHARVESTFINISHED` datetime DEFAULT NULL,
  `NAME` varchar(255) DEFAULT NULL,
  `CURRENTSTATUS` varchar(255) DEFAULT NULL,
  `CONTACTNOTES` varchar(4096) DEFAULT NULL,
  `AMOUNTHARVESTED` int(11) DEFAULT NULL,
  `SERVICEPROVIDER` varchar(255) DEFAULT NULL,
  `MESSAGE` varchar(4096) DEFAULT NULL,
  `MAXDBSIZE` int(11) DEFAULT NULL,
  `HARVESTIMMEDIATELY` tinyint(1) NOT NULL DEFAULT '0',
  `FILETYPEMASKS` varchar(255) DEFAULT NULL,
  `URIMASKS` varchar(255) DEFAULT NULL,
  `STARTURLS` varchar(16384) DEFAULT NULL,
  `RECURSIONDEPTH` int(11) DEFAULT NULL,
  `EXPECTEDSCHEMA` varchar(255) DEFAULT NULL,
  `URL` varchar(16384) DEFAULT NULL,
  `NORMALIZATIONFILTER` varchar(255) DEFAULT NULL,
  `SCHEMAURI` varchar(255) DEFAULT NULL,
  `OAISETNAME` varchar(255) DEFAULT NULL,
  `FROMDATE` date DEFAULT NULL,
  `UNTILDATE` date DEFAULT NULL,
  `METADATAPREFIX` varchar(255) DEFAULT NULL,
  `DATEFORMAT` varchar(255) DEFAULT NULL,
  `RESUMPTIONTOKEN` varchar(255) DEFAULT NULL,
  `STORAGE_ID` bigint(20) DEFAULT NULL,
  `TRANSFORMATION_ID` bigint(20) DEFAULT NULL,
  `OVERWRITE` tinyint(1) DEFAULT NULL,
  `SPLITAT` varchar(255) DEFAULT NULL,
  `SPLITSIZE` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `FK_HARVESTABLE_STORAGE_ID` (`STORAGE_ID`),
  CONSTRAINT `FK_HARVESTABLE_STORAGE_ID` FOREIGN KEY (`STORAGE_ID`) REFERENCES `STORAGE` (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `HARVESTABLE`
--

LOCK TABLES `HARVESTABLE` WRITE;
/*!40000 ALTER TABLE `HARVESTABLE` DISABLE KEYS */;
INSERT INTO `HARVESTABLE` VALUES (52,'OaiPmhResource',1,'2011-09-16 14:37:13','','2011-05-12 16:00:34','','2011-09-14 16:53:01','53 16 * * 3','2011-09-14 16:53:11','RUG NL','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://ir.ub.rug.nl/oai/','',NULL,'',NULL,NULL,'oai_dc','yyyy-MM-dd',NULL,102,10,0,NULL,NULL),(102,'OaiPmhResource',1,'2011-09-16 14:38:08','First feed from Thomas Dowling','2011-08-05 12:36:26','','2011-09-11 10:00:00','0 10 * * *','2011-08-29 15:28:52','Ohiolink ','NEW','',NULL,'Ohiolink',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://olc3.ohiolink.edu/~tdowling/oai/request.cgi','321601::20110910:118101',NULL,'',NULL,'2011-09-10','oai_dc','yyyy-MM-dd',NULL,102,10,0,NULL,NULL),(103,'OaiPmhResource',1,'2011-09-16 14:38:34','','2011-05-18 13:31:38','','2011-09-10 20:00:46','0 6 * * *','2011-09-10 20:04:18','Alexandria','NEW','',NULL,'Alexandria - University of St.Gallen (Switzerland)',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://www.alexandria.unisg.ch/EXPORT/OAI/server.oai','',NULL,'',NULL,NULL,'oai_dc','yyyy-MM-dd',NULL,102,10,1,NULL,NULL),(152,'OaiPmhResource',1,'2011-09-16 14:38:21','','2011-05-18 13:38:59','','2011-09-13 15:00:04','0 15 * * 2','2011-09-13 15:00:24','Zurich Open Repository and Archive','NEW','',NULL,'Zurich Open Repository and Archive',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://www.zora.uzh.ch/cgi/oai2','',NULL,'',NULL,NULL,'oai_dc','yyyy-MM-dd',NULL,102,10,0,NULL,NULL),(156,'OaiPmhResource',1,'2011-09-16 14:36:44','','2011-05-18 14:27:12','','2011-09-16 12:00:05','0 12 * * *','2011-09-16 12:00:15','Discovery','NEW','',NULL,'Dundee AC UK',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://discovery.dundee.ac.uk/oai/request','',NULL,'',NULL,NULL,'oai_dc','yyyy-MM-dd',NULL,102,10,0,NULL,NULL),(202,'OaiPmhResource',1,'2011-09-16 14:36:36','http://www.diva-portal.org/dice/oai?verb=ListRecords&metadataPrefix=marc21','2011-05-22 17:16:50','','2011-09-14 13:00:04','0 13 * * *','2011-09-13 13:00:13','Diva-portal (marc21)','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://www.diva-portal.org/dice/oai','',NULL,'',NULL,'2011-09-13','marc21','yyyy-MM-dd',NULL,102,20,0,NULL,NULL),(253,'OaiPmhResource',1,'2011-09-16 14:38:41','','2011-05-22 21:40:47','','2011-09-13 09:00:02','0 9 * * *','2011-09-11 11:50:04','Annals of Genealogical Research','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://www.genlit.org/agr/oai/','',NULL,'',NULL,'2011-09-12','oai_dc','yyyy-MM-dd',NULL,102,10,0,NULL,NULL),(254,'OaiPmhResource',1,'2011-09-16 14:36:49','','2011-05-22 21:53:38','','2011-09-15 10:00:03','0 10 * * *','2011-09-15 10:00:13','Aston University Research Archive','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://eprints.aston.ac.uk/cgi/oai2','',NULL,'',NULL,NULL,'oai_dc','yyyy-MM-dd',NULL,102,10,1,NULL,NULL),(255,'OaiPmhResource',0,'2011-09-16 14:35:48','','2011-05-22 22:01:29','','2011-09-16 11:00:02','0 11 * * *','2011-06-12 14:43:46','Internet Archive','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://www.archive.org/services/oai.php','',NULL,'collection:texts',NULL,'2011-09-15','oai_dc','yyyy-MM-dd',NULL,102,10,0,NULL,NULL),(303,'OaiPmhResource',1,'2011-09-16 14:38:13','','2011-05-23 10:41:06','','2011-09-10 20:38:28','0 14 * * 1','2011-09-04 14:00:12','Universit√§t Potsdam','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,'http://opus.kobv.de/ubp/oai2/oai2.php','746',NULL,'',NULL,'2011-09-09','oai_dc','yyyy-MM-dd',NULL,102,10,0,NULL,NULL),(2952,'XmlBulkResource',0,'2011-09-16 14:35:04','','2011-09-01 16:43:43','','2011-09-07 20:24:50','0 0 * * *','2011-09-06 16:15:56','Koha XML import (localhost)','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,'','http://localhost:8080/solr/koha.xml\r\n',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,102,2953,1,'',''),(3104,'XmlBulkResource',1,'2011-09-16 14:36:05','Project Gutenberg import','2011-09-05 17:04:53','','2011-09-14 10:00:02','0 10 * * *','2011-09-13 15:45:34','Gutenberg','NEW','',NULL,'Index Data',NULL,NULL,0,NULL,NULL,NULL,NULL,'','http://localhost:8080/solr/catalog.rdf',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,102,3102,0,'1','100'),(3302,'XmlBulkResource',1,'2011-09-16 14:35:58','','2011-09-06 17:46:12','','2011-09-15 00:00:01','0 0 * * *','2011-09-13 16:25:01','Gutenberg (small)','NEW','',NULL,'',NULL,NULL,0,NULL,NULL,NULL,NULL,'100','http://localhost:8080/solr/catalog-small-format.rdf',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,102,3102,0,'1','100');
/*!40000 ALTER TABLE `HARVESTABLE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `SEQUENCE`
--

DROP TABLE IF EXISTS `SEQUENCE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SEQUENCE` (
  `SEQ_NAME` varchar(50) NOT NULL,
  `SEQ_COUNT` decimal(38,0) DEFAULT NULL,
  PRIMARY KEY (`SEQ_NAME`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `SEQUENCE`
--

LOCK TABLES `SEQUENCE` WRITE;
/*!40000 ALTER TABLE `SEQUENCE` DISABLE KEYS */;
INSERT INTO `SEQUENCE` VALUES ('SEQ_GEN',3651);
/*!40000 ALTER TABLE `SEQUENCE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `STEP`
--

DROP TABLE IF EXISTS `STEP`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `STEP` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `DESCRIPTION` varchar(4096) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `NAME` varchar(255) DEFAULT NULL,
  `SCRIPT` text,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `STEP`
--

LOCK TABLES `STEP` WRITE;
/*!40000 ALTER TABLE `STEP` DISABLE KEYS */;
INSERT INTO `STEP` VALUES (10,'BasicTransformationStep',NULL,1,'OAIPMH-DC to PZ','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!--\n\n    This stylesheet expects oai/dc records\n-->\n<xsl:stylesheet\n    version=\"1.0\"\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\n    xmlns:oai=\"http://www.openarchives.org/OAI/2.0/\"\n    xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n    xmlns:dcterms=\"http://purl.org/dc/terms/\">\n\n  <xsl:output indent=\"yes\"\n              method=\"xml\"\n              version=\"1.0\"\n              encoding=\"UTF-8\"/>\n\n  <xsl:template match=\"/oai:OAI-PMH\">\n    <xsl:apply-templates/>\n  </xsl:template>\n\n  <xsl:template match=\"oai:ListRecords\">\n    <pz:collection>\n      <xsl:apply-templates/>\n    </pz:collection>\n  </xsl:template>\n\n  <xsl:template match=\"oai:record\">\n    <pz:record>\n      <pz:metadata type=\"id\">\n        <xsl:value-of select=\"oai:header/oai:identifier\"/>\n      </pz:metadata>\n      <xsl:if test=\"oai:header[@status=\'deleted\']\">\n  <pz:metadata type=\"record_status\">deleted</pz:metadata>\n      </xsl:if>\n      <xsl:apply-templates/>\n    </pz:record>\n  </xsl:template>\n    \n  <xsl:template match=\"oai:metadata/*\">\n    <xsl:for-each select=\"dc:title\">\n      <pz:metadata type=\"title\">\n        <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n\n    <xsl:for-each select=\"dc:date\">\n      <pz:metadata type=\"date\">\n   <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n\n    <xsl:for-each select=\"dc:subject\">\n      <pz:metadata type=\"subject\">\n <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n\n    <xsl:for-each select=\"dc:creator\">\n      <pz:metadata type=\"author\">\n        <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n\n    <xsl:for-each select=\"dc:description\">\n      <pz:metadata type=\"description\">\n   <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n\n    <xsl:for-each select=\"dc:identifier\">\n      <pz:metadata type=\"electronic-url\">\n   <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n\n    <xsl:for-each select=\"dc:type\">\n      <pz:metadata type=\"medium\">\n <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n      \n    <xsl:for-each select=\"dcterms:bibliographicCitation\">\n      <pz:metadata type=\"citation\">\n        <xsl:value-of select=\".\"/>\n      </pz:metadata>\n    </xsl:for-each>\n\n  </xsl:template>\n\n  <xsl:template match=\"text()\"/>\n\n</xsl:stylesheet>'),(20,'BasicTransformationStep',NULL,1,'OAIPMH-MARC to MARC21','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!--\n\n    This stylesheet pulls out marc records from the oai-pmh response\n    and overwrites the controlfield 001 with oai-identifier\n-->\n<xsl:stylesheet\n    version=\"1.0\"\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n    xmlns:oai=\"http://www.openarchives.org/OAI/2.0/\"\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\"\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\n    exclude-result-prefixes=\"oai\">\n\n\n <xsl:output indent=\"yes\"\n        method=\"xml\"\n        version=\"1.0\"\n        encoding=\"UTF-8\"/>\n\n\n<xsl:template match=\"/\">\n<collection>\n  <xsl:apply-templates/>\n</collection>\n\n</xsl:template>\n\n  <xsl:template match=\"//oai:record\">\n    <xsl:if test=\"oai:header[@status=\'deleted\']\">\n      <delete><xsl:attribute name=\"id\"><xsl:value-of select=\"oai:header/oai:identifier\"/></xsl:attribute></delete>\n    </xsl:if>\n    <xsl:if test=\"not(oai:header[@status=\'deleted\'])\">\n      <xsl:variable name=\"oai-id\">\n          <xsl:value-of select=\"oai:header/oai:identifier\"/>\n      </xsl:variable>\n\n      <xsl:for-each select=\"oai:metadata/marc:record\">\n        <xsl:copy>\n          <xsl:copy-of select=\"@*\"/>\n          <xsl:copy-of select=\"*\"/>\n          <pz:metadata type=\"id\">\n           <xsl:value-of select=\"$oai-id\"/>\n          </pz:metadata>\n        </xsl:copy>\n      </xsl:for-each>\n    </xsl:if>\n  </xsl:template>\n\n  <xsl:template match=\"text()\"/>\n\n</xsl:stylesheet>'),(22,'BasicTransformationStep',NULL,1,'MARC21 to PZ','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\">\r\n\r\n  \r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\"/>\r\n\r\n<!-- Extract metadata from MARC21/USMARC \r\n      http://www.loc.gov/marc/bibliographic/ecbdhome.html\r\n  <xsl:include href=\"pz2-ourl-marc21.xsl\" />\r\n-->  \r\n\r\n  <xsl:template match=\"/\">\r\n    <pz:collection> \r\n      <xsl:apply-templates />\r\n    </pz:collection>\r\n  </xsl:template>        \r\n  \r\n  <xsl:template match=\"//delete\">\r\n  <xsl:copy-of select=\".\"/>                                                                                                                                                                               \r\n  </xsl:template> \r\n  \r\n  <xsl:template match=\"//marc:record\">\r\n    <xsl:variable name=\"title_medium\" select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'h\']\"/>\r\n    <xsl:variable name=\"journal_title\" select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\"/>\r\n    <xsl:variable name=\"electronic_location_url\" select=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'u\']\"/>\r\n    <xsl:variable name=\"fulltext_a\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\"/>\r\n    <xsl:variable name=\"fulltext_b\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\"/>\r\n    <xsl:variable name=\"medium\">\r\n      <xsl:choose>\r\n  <xsl:when test=\"$title_medium\">\r\n     <xsl:value-of select=\"substring-after(substring-before($title_medium,\']\'),\'[\')\"/>\r\n   </xsl:when>\r\n <xsl:when test=\"$fulltext_a\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$fulltext_b\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$journal_title\">\r\n    <xsl:text>article</xsl:text>\r\n  </xsl:when>\r\n <xsl:otherwise>\r\n   <xsl:text>book</xsl:text>\r\n </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>      \r\n      <xsl:for-each select=\"marc:controlfield[@tag=\'001\']\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'010\']\">\r\n        <pz:metadata type=\"lccn\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'020\']\">\r\n        <pz:metadata type=\"isbn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'022\']\">\r\n        <pz:metadata type=\"issn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'027\']\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'035\']\">\r\n        <pz:metadata type=\"system-control-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'100\']\">\r\n <pz:metadata type=\"author\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-date\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'110\']\">\r\n <pz:metadata type=\"corporate-name\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"corporate-location\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"corporate-date\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'111\']\">\r\n <pz:metadata type=\"meeting-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"meeting-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"meeting-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n <pz:metadata type=\"date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'245\']\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'h\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'n\']\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'250\']\">\r\n <pz:metadata type=\"edition\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n        <pz:metadata type=\"publication-place\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'300\']\">\r\n <pz:metadata type=\"physical-extent\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-format\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-dimensions\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-accomp\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'e\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unittype\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unitsize\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-specified\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'3\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'440\']\">\r\n <pz:metadata type=\"series-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag = \'500\' or @tag = \'505\' or @tag = \'518\' or @tag = \'520\' or @tag = \'522\']\">\r\n   <pz:metadata type=\"description\">\r\n            <xsl:value-of select=\"*/text()\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n        <pz:metadata type=\"subject\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"subject-long\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text>, </xsl:text>\r\n       </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'856\']\">\r\n <pz:metadata type=\"electronic-url\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'u\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-text\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'y\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-note\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'z\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'773\']\">\r\n        <pz:metadata type=\"citation\">\r\n          <xsl:for-each select=\"*\">\r\n            <xsl:value-of select=\"normalize-space(.)\"/>\r\n            <xsl:text> </xsl:text>\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"marc:subfield[@code=\'t\']\">\r\n          <pz:metadata type=\"journal-title\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'t\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"marc:subfield[@code=\'g\']\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n <xsl:value-of select=\"$medium\"/>\r\n      </pz:metadata>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\">\r\n <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_a\"/>\r\n    </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\">\r\n    <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_b\"/>\r\n    </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'907\' or @tag=\'901\']\">\r\n        <pz:metadata type=\"iii-id\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'926\']\">\r\n        <pz:metadata type=\"holding\">\r\n     <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'948\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'991\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n<!--\r\n      <xsl:if test=\"$open_url_resolver\">\r\n        <pz:metadata type=\"open-url\">\r\n            <xsl:call-template name=\"insert-md-openurl\" />\r\n        </pz:metadata>\r\n      </xsl:if>\r\n-->\r\n      <!--passthrough id data-->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n          <xsl:copy-of select=\".\"/>\r\n      </xsl:for-each>\r\n\r\n    </pz:record>    \r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>'),(903,'BasicTransformationStep','<Description>',NULL,'Step 2','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n\r\n'),(905,'BasicTransformationStep','<Description>',NULL,'Step 3','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>'),(953,'BasicTransformationStep','<Description>',NULL,'Step 4','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>'),(1003,'BasicTransformationStep','<Description>',NULL,'Step 5','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>'),(1053,'BasicTransformationStep','<Description>',NULL,'Step 1','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n'),(2726,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(2761,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(2803,'BasicTransformationStep','<Description>',NULL,'Step 6','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>'),(2814,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(2824,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(2836,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(2858,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(2866,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(3003,'BasicTransformationStep','<Description>',NULL,'Marc XML','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\">\r\n\r\n  \r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\"/>\r\n\r\n<!-- Extract metadata from MARC21/USMARC \r\n      http://www.loc.gov/marc/bibliographic/ecbdhome.html\r\n-->  \r\n  <xsl:include href=\"pz2-ourl-marc21.xsl\" />\r\n\r\n  <xsl:template match=\"/\">\r\n    <pz:collection> \r\n      <xsl:apply-templates />\r\n    </pz:collection>\r\n  </xsl:template>                \r\n  \r\n  <xsl:template match=\"//delete\">\r\n    <xsl:copy-of select=\".\"/>                                                                                                                                                                               \r\n  </xsl:template>                \r\n  \r\n  <xsl:template match=\"//marc:record\">\r\n    <xsl:variable name=\"title_medium\" select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'h\']\"/>\r\n    <xsl:variable name=\"journal_title\" select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\"/>\r\n    <xsl:variable name=\"electronic_location_url\" select=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'u\']\"/>\r\n    <xsl:variable name=\"fulltext_a\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\"/>\r\n    <xsl:variable name=\"fulltext_b\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\"/>\r\n    <xsl:variable name=\"medium\">\r\n      <xsl:choose>\r\n   <xsl:when test=\"$title_medium\">\r\n     <xsl:value-of select=\"substring-after(substring-before($title_medium,\']\'),\'[\')\"/>\r\n   </xsl:when>\r\n <xsl:when test=\"$fulltext_a\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$fulltext_b\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$journal_title\">\r\n    <xsl:text>article</xsl:text>\r\n  </xsl:when>\r\n <xsl:otherwise>\r\n   <xsl:text>book</xsl:text>\r\n </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>      \r\n      <xsl:for-each select=\"marc:controlfield[@tag=\'001\']\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'010\']\">\r\n        <pz:metadata type=\"lccn\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'020\']\">\r\n        <pz:metadata type=\"isbn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'022\']\">\r\n        <pz:metadata type=\"issn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'027\']\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'035\']\">\r\n        <pz:metadata type=\"system-control-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'100\']\">\r\n <pz:metadata type=\"author\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-date\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'110\']\">\r\n <pz:metadata type=\"corporate-name\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"corporate-location\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"corporate-date\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'111\']\">\r\n <pz:metadata type=\"meeting-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"meeting-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"meeting-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n <pz:metadata type=\"date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'245\']\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'h\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'n\']\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'250\']\">\r\n <pz:metadata type=\"edition\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n        <pz:metadata type=\"publication-place\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'300\']\">\r\n <pz:metadata type=\"physical-extent\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-format\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-dimensions\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-accomp\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'e\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unittype\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unitsize\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-specified\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'3\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'440\']\">\r\n <pz:metadata type=\"series-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag = \'500\' or @tag = \'505\' or\r\n              @tag = \'518\' or @tag = \'520\' or @tag = \'522\']\">\r\n  <pz:metadata type=\"description\">\r\n            <xsl:value-of select=\"*/text()\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n        <pz:metadata type=\"subject\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"subject-long\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text>, </xsl:text>\r\n       </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'856\']\">\r\n <pz:metadata type=\"electronic-url\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'u\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-text\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'y\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-note\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'z\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'773\']\">\r\n        <pz:metadata type=\"citation\">\r\n          <xsl:for-each select=\"*\">\r\n            <xsl:value-of select=\"normalize-space(.)\"/>\r\n            <xsl:text> </xsl:text>\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"marc:subfield[@code=\'t\']\">\r\n          <pz:metadata type=\"journal-title\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'t\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"marc:subfield[@code=\'g\']\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n <xsl:value-of select=\"$medium\"/>\r\n      </pz:metadata>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\">\r\n <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_a\"/>\r\n    </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\">\r\n    <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_b\"/>\r\n    </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'907\' or @tag=\'901\']\">\r\n        <pz:metadata type=\"iii-id\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'926\']\">\r\n        <pz:metadata type=\"holding\">\r\n     <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'948\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'991\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:if test=\"$open_url_resolver\">\r\n        <pz:metadata type=\"open-url\">\r\n            <xsl:call-template name=\"insert-md-openurl\" />\r\n        </pz:metadata>\r\n      </xsl:if>\r\n\r\n      <!--passthrough id data-->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n          <xsl:copy-of select=\".\"/>\r\n      </xsl:for-each>\r\n\r\n    </pz:record>    \r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>\r\n'),(3005,'BasicTransformationStep','<Description>',NULL,'Turbo Marc','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"1.0\"\r\n  xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n  xmlns:tmarc=\"http://www.indexdata.com/turbomarc\">\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\"\r\n    encoding=\"UTF-8\" />\r\n  <xsl:param name=\"medium\"/>\r\n\r\n  <!-- Extract metadata from MARC21/USMARC from streamlined marcxml format \r\n    http://www.loc.gov/marc/bibliographic/ecbdhome.html -->\r\n  <xsl:template name=\"record-hook\" />\r\n\r\n\r\n  <xsl:template match=\"/\">\r\n      <xsl:apply-templates />\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"tmarc:collection\">\r\n    <collection>\r\n      <xsl:apply-templates />\r\n    </collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"tmarc:r\">\r\n    <xsl:variable name=\"title_medium\" select=\"tmarc:d245/tmarc:sh\" />\r\n    <xsl:variable name=\"journal_title\" select=\"tmarc:d773/tmarc:st\" />\r\n    <xsl:variable name=\"electronic_location_url\" select=\"tmarc:d856/tmarc:su\" />\r\n    <xsl:variable name=\"fulltext_a\" select=\"tmarc:d900/tmarc:sa\" />\r\n    <xsl:variable name=\"fulltext_b\" select=\"tmarc:d900/tmarc:sb\" />\r\n    <!-- Does not always hit the right substring. The field is not always fixed-width? -->\r\n    <xsl:variable name=\"control_lang\" select=\"substring(tmarc:c008, 36, 3)\" />\r\n    <xsl:variable name=\"contains110\" select=\"tmarc:d110\" />\r\n    <xsl:variable name=\"hasAuthorFields\" select=\"tmarc:d100 or tmarc:d111\" />\r\n    <xsl:variable name=\"typeofrec\" select=\"substring(tmarc:l, 7, 1)\"/>\r\n    <xsl:variable name=\"typeofvm\" select=\"substring(tmarc:c008, 34, 1)\"/>\r\n    <xsl:variable name=\"biblevel\" select=\"substring(tmarc:l, 8, 1)\"/>\r\n    <xsl:variable name=\"physdes\" select=\"substring(tmarc:c007, 1, 1)\"/>\r\n    <xsl:variable name=\"form1\" select=\"substring(tmarc:c008, 24, 1)\"/>\r\n    <xsl:variable name=\"form2\" select=\"substring(tmarc:c008, 30, 1)\"/>\r\n    <xsl:variable name=\"oclca\" select=\"substring(tmarc:c007, 1, 1)\"/>\r\n    <xsl:variable name=\"oclcb\" select=\"substring(tmarc:c007, 2, 1)\"/>\r\n    <xsl:variable name=\"oclcd\" select=\"substring(tmarc:c007, 4, 1)\"/>\r\n    <xsl:variable name=\"oclce\" select=\"substring(tmarc:c007, 5, 1)\"/>\r\n    <xsl:variable name=\"typeofserial\" select=\"substring(tmarc:c008, 22, 1)\"/>\r\n\r\n    <xsl:variable name=\"electronic\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"$form1=\'s\' or $form1=\'q\' or $form1=\'o\' or\r\n      $form2=\'s\' or $form2=\'q\' or $form2=\'o\'\">\r\n     <xsl:text>yes</xsl:text>\r\n </xsl:when>\r\n <xsl:otherwise/>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"vmedium\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"string-length($medium)\"><xsl:value-of select=\"$medium\" /></xsl:when>\r\n        <xsl:when test=\"($typeofrec=\'a\' or $typeofrec=\'t\') and $biblevel=\'m\'\">book</xsl:when>\r\n        <xsl:when test=\"$typeofrec=\'j\' or $typeofrec=\'i\'\">\r\n      <xsl:text>recording</xsl:text>\r\n      <xsl:choose>\r\n      <xsl:when test=\"$oclcb=\'d\' and $oclcd=\'f\'\">-cd</xsl:when>\r\n     <xsl:when test=\"$oclcb=\'s\'\">-cassette</xsl:when>\r\n        <xsl:when test=\"$oclcb=\'d\' and $oclcd=\'a\' or $oclcd=\'b\' or\r\n         $oclcd=\'c\' or $oclcd=\'d\' or $oclcd=\'e\'\">-vinyl</xsl:when>\r\n    </xsl:choose>\r\n </xsl:when>\r\n <xsl:when test=\"$typeofrec=\'g\'\">\r\n      <xsl:choose>\r\n      <xsl:when test=\"$typeofvm=\'m\' or $typeofvm=\'v\'\">\r\n        <xsl:text>video</xsl:text>\r\n          <xsl:choose>\r\n          <xsl:when test=\"$oclca=\'v\' and $oclcb=\'d\' and $oclce=\'v\'\">-dvd</xsl:when>\r\n           <xsl:when test=\"$oclca=\'v\' and $oclcb=\'d\' and $oclce=\'s\'\">-blu-ray</xsl:when>\r\n           <xsl:when test=\"$oclca=\'v\' and $oclcb=\'f\' and $oclce=\'b\'\">-vhs</xsl:when>\r\n         </xsl:choose>\r\n     </xsl:when>\r\n     <xsl:otherwise>audio-visual</xsl:otherwise>\r\n   </xsl:choose>\r\n </xsl:when>\r\n <xsl:when test=\"$typeofrec=\'a\' and $biblevel=\'s\'\">\r\n      <xsl:choose>\r\n      <xsl:when test=\"$typeofserial=\'n\'\">newspaper</xsl:when>\r\n     <xsl:otherwise>journal</xsl:otherwise>\r\n    </xsl:choose>\r\n </xsl:when>\r\n <xsl:when test=\"$typeofrec=\'e\' or $typeofrec=\'f\'\">map</xsl:when>\r\n  <xsl:when test=\"$typeofrec=\'c\' or $typeofrec=\'d\'\">music-score</xsl:when>\r\n  <xsl:when test=\"$form1=\'a\' or $form1=\'b\' or $form1=\'c\'\">microform</xsl:when>\r\n    <xsl:when test=\"$typeofrec=\'t\'\">thesis</xsl:when>\r\n        <!-- <xsl:when test=\"$journal_title\">article</xsl:when> -->\r\n  <xsl:when test=\"$typeofrec=\'a\' or $typeofrec=\'i\' and\r\n       ($typeofserial=\'d\' or $typeofserial=\'w\')\">web</xsl:when>\r\n   <xsl:when test=\"$typeofrec=\'a\' and $biblevel=\'b\'\">article</xsl:when>\r\n  <xsl:when test=\"$typeofrec=\'m\'\">electronic</xsl:when>\r\n        <xsl:when test=\"$title_medium\">\r\n          <xsl:value-of select=\"translate($title_medium, \' []/:\', \'\')\" />\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:text>other</xsl:text>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"has_fulltext\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"tmarc:d856/tmarc:sq\">\r\n          <xsl:text>yes</xsl:text>\r\n        </xsl:when>\r\n        <xsl:when test=\"tmarc:d856/tmarc:si=\'TEXT*\'\">\r\n          <xsl:text>yes</xsl:text>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:text>no</xsl:text>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"oclc_number\">\r\n      <xsl:choose>\r\n        <xsl:when test=\'contains(tmarc:c001,\"ocn\") or\r\n                        contains(tmarc:c001,\"ocm\") or\r\n                        contains(tmarc:c001,\"OCoLC\") \'>\r\n         <xsl:value-of select=\"tmarc:c001\"/>\r\n        </xsl:when>\r\n        <xsl:when test=\'contains(tmarc:d035/tmarc:sa,\"ocn\") or\r\n                        contains(tmarc:d035/tmarc:sa,\"ocm\") or\r\n                        contains(tmarc:d035/tmarc:sa,\"OCoLC\") \'>\r\n         <xsl:value-of select=\"tmarc:d035/tmarc:sa\"/>\r\n        </xsl:when>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"date_008\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"contains(\'cestpudikmr\', substring(tmarc:c008, 7, 1))\">\r\n          <xsl:value-of select=\"substring(tmarc:c008, 8, 4)\" />\r\n        </xsl:when>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"date_end_008\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"contains(\'dikmr\', substring(tmarc:c008, 7, 1))\">\r\n          <xsl:value-of select=\"substring(tmarc:c008, 12, 4)\" />\r\n        </xsl:when>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>\r\n<!--\r\n      <xsl:attribute name=\"mergekey\">\r\n    <xsl:text>title </xsl:text>\r\n  <xsl:value-of select=\"tmarc:d245/tmarc:sa\" />\r\n  <xsl:text> author </xsl:text>\r\n  <xsl:value-of select=\"tmarc:d100/tmarc:sa\" />\r\n  <xsl:text> medium </xsl:text>\r\n  <xsl:value-of select=\"$medium\" />\r\n    </xsl:attribute>\r\n  -->\r\n\r\n      <xsl:for-each select=\"tmarc:c001\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"oclc-number\">\r\n        <xsl:value-of select=\"$oclc_number\" />\r\n      </pz:metadata>\r\n\r\n      <xsl:for-each select=\"tmarc:d010\">\r\n        <pz:metadata type=\"lccn\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d020\">\r\n        <pz:metadata type=\"isbn\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d022\">\r\n        <pz:metadata type=\"issn\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d027\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d035\"> \r\n        <pz:metadata type=\"system-control-nr\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sa\">\r\n              <xsl:value-of select=\"tmarc:sa\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>\r\n              <xsl:value-of select=\"tmarc:sb\"/>\r\n            </xsl:otherwise>\r\n          </xsl:choose>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d100\">\r\n        <pz:metadata type=\"author\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"author-title\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"author-date\">\r\n          <xsl:value-of select=\"tmarc:sd\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d110\">\r\n        <pz:metadata type=\"corporate-name\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"corporate-location\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"corporate-date\">\r\n          <xsl:value-of select=\"tmarc:sd\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d111\">\r\n        <pz:metadata type=\"meeting-name\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"meeting-location\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"meeting-date\">\r\n          <xsl:value-of select=\"tmarc:sd\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d260\">\r\n        <pz:metadata type=\"date\">\r\n          <xsl:value-of select=\"translate(tmarc:sc, \'cp[].\', \'\')\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:if test=\"$date_008 and not(tmarc:d260)\">\r\n        <pz:metadata type=\"date\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"$date_end_008\">\r\n              <xsl:value-of select=\"concat($date_008,\'-\',$date_end_008)\" />\r\n            </xsl:when>\r\n            <xsl:otherwise> \r\n              <xsl:value-of select=\"$date_008\" />\r\n            </xsl:otherwise>\r\n          </xsl:choose>\r\n        </pz:metadata>\r\n      </xsl:if>\r\n\r\n\r\n      <xsl:for-each select=\"tmarc:d130\">\r\n        <pz:metadata type=\"title-uniform\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-media\">\r\n          <xsl:value-of select=\"tmarc:sm\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-parts\">\r\n          <xsl:value-of select=\"tmarc:sn\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-partname\">\r\n          <xsl:value-of select=\"tmarc:sp\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-key\">\r\n          <xsl:value-of select=\"tmarc:sr\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d245\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"tmarc:sb\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"tmarc:sf\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"tmarc:sh\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"tmarc:sn\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-complete\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n          <xsl:if test=\"tmarc:sb\" ><xsl:value-of select=\"concat(\' \', tmarc:sb)\" /></xsl:if>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d250\">\r\n        <pz:metadata type=\"edition\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d260\">\r\n        <pz:metadata type=\"publication-place\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n          <xsl:value-of select=\"tmarc:sb\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d300\">\r\n        <pz:metadata type=\"physical-extent\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-format\">\r\n          <xsl:value-of select=\"tmarc:sb\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-dimensions\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-accomp\">\r\n          <xsl:value-of select=\"tmarc:se\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-unittype\">\r\n          <xsl:value-of select=\"tmarc:sf\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-unitsize\">\r\n          <xsl:value-of select=\"tmarc:sg\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-specified\">\r\n          <xsl:value-of select=\"tmarc:s3\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d440\">\r\n        <pz:metadata type=\"series-title\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d500\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d505\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d518\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d520\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d522\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d911\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d600\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d610\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d611\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d630\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d648\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d650\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d651\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d653\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d654\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d655\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d656\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d657\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d658\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d662\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d69X\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- or tmarc:d651 or tmarc:d653 or tmarc:d654 or tmarc:d655 or tmarc:d656 \r\n        or tmarc:d657 or tmarc:d658 or tmarc:d662 or tmarc:d69X\"> -->\r\n\r\n      <!-- <xsl:for-each select=\"tmarc:d600\" > <pz:metadata type=\"subject\"> \r\n        <xsl:value-of select=\"tmarc:sa\"/> </pz:metadata> <pz:metadata type=\"subject-long\"> \r\n        <xsl:for-each select=\"tmarc:sa tmarc:sb tmarc:sc tmarc:sd \"> <xsl:if test=\"position() \r\n        > 1\"> <xsl:text>, </xsl:text> </xsl:if> <xsl:value-of select=\".\"/> </xsl:for-each> \r\n        </pz:metadata> </xsl:for-each> -->\r\n\r\n      <xsl:for-each select=\"tmarc:d856\">\r\n        <pz:metadata type=\"electronic-url\">\r\n          <xsl:value-of select=\"tmarc:su\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-text\">\r\n          <xsl:choose>\r\n       <xsl:when test=\"tmarc:sy\">\r\n          <xsl:value-of select=\"tmarc:sy/text()\" />\r\n       </xsl:when>\r\n     <xsl:when test=\"tmarc:s3\">\r\n          <xsl:value-of select=\"tmarc:s3/text()\" />\r\n       </xsl:when>\r\n      <xsl:otherwise>Get resource</xsl:otherwise>\r\n       </xsl:choose>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-note\">\r\n          <xsl:value-of select=\"tmarc:sz\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-format-instruction\">\r\n          <xsl:value-of select=\"tmarc:si\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-format-type\">\r\n          <xsl:value-of select=\"tmarc:sq\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d773\">\r\n        <pz:metadata type=\"citation\">\r\n          <xsl:for-each select=\"*\">\r\n            <xsl:value-of select=\"normalize-space(.)\" />\r\n            <xsl:text> </xsl:text>\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"tmarc:st\">\r\n          <pz:metadata type=\"journal-title\">\r\n            <xsl:value-of select=\"tmarc:st\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"tmarc:sg\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"tmarc:sg\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"tmarc:sp\">\r\n          <pz:metadata type=\"journal-title-abbrev\">\r\n            <xsl:value-of select=\"tmarc:sp\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d852\">\r\n        <xsl:if test=\"tmarc:sy\">\r\n          <pz:metadata type=\"publicnote\">\r\n            <xsl:value-of select=\"tmarc:sy\" />\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"tmarc:sh\">\r\n          <pz:metadata type=\"callnumber\">\r\n            <xsl:value-of select=\"tmarc:sh\" />\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d876\">\r\n        <xsl:if test=\"tmarc:sf\">\r\n          <pz:metadata type=\"loan-period\">\r\n            <xsl:value-of select=\"tmarc:sf\" />\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n        <xsl:value-of select=\"$vmedium\" />\r\n   <xsl:if test=\"string-length($electronic) and $vmedium != \'electronic\'\">\r\n   <xsl:text> (electronic)</xsl:text>\r\n    </xsl:if>\r\n      </pz:metadata>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sa\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\"> <pz:metadata type=\"fulltext\"> <xsl:value-of \r\n        select=\"$fulltext_a\"/> </pz:metadata> </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sb\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:se\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sf\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:si\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sk\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sq\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:ss\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:su\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sy\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\"> <pz:metadata type=\"fulltext\"> <xsl:value-of \r\n        select=\"$fulltext_b\"/> </pz:metadata> </xsl:if> -->\r\n\r\n      <pz:metadata type=\"has-fulltext\">\r\n        <xsl:value-of select=\"$has_fulltext\"/>\r\n      </pz:metadata>\r\n\r\n      <xsl:for-each select=\"tmarc:d907 | tmarc:d901\">\r\n        <pz:metadata type=\"iii-id\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d926\">\r\n        <pz:metadata type=\"locallocation\">\r\n     <xsl:choose><xsl:when test=\"tmarc:sa\">\r\n      <xsl:value-of select=\"tmarc:sa\"/>\r\n   </xsl:when><xsl:otherwise>\r\n        <xsl:text>PAZPAR2_NULL_VALUE</xsl:text>\r\n   </xsl:otherwise></xsl:choose>\r\n </pz:metadata>\r\n        <pz:metadata type=\"callnumber\">\r\n   <xsl:choose><xsl:when test=\"tmarc:sc\">\r\n      <xsl:value-of select=\"tmarc:sc\"/>\r\n   </xsl:when><xsl:otherwise>\r\n        <xsl:text>PAZPAR2_NULL_VALUE</xsl:text>\r\n   </xsl:otherwise></xsl:choose>\r\n </pz:metadata>\r\n        <pz:metadata type=\"available\">\r\n    <xsl:choose><xsl:when test=\"tmarc:se\">\r\n      <xsl:value-of select=\"tmarc:se\"/>\r\n   </xsl:when><xsl:otherwise>\r\n        <xsl:text>PAZPAR2_NULL_VALUE</xsl:text>\r\n   </xsl:otherwise></xsl:choose>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- OhioLINK holdings -->\r\n      <xsl:for-each select=\"tmarc:d945\">\r\n   <pz:metadata type=\"locallocation\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sa\">\r\n              <xsl:value-of select=\"tmarc:sa\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n  </pz:metadata>\r\n  <pz:metadata type=\"callnumber\">\r\n          <xsl:choose>\r\n     <xsl:when test=\"tmarc:sb\">\r\n              <xsl:value-of select=\"tmarc:sb\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n    </pz:metadata>\r\n  <pz:metadata type=\"publicnote\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sc\">\r\n              <xsl:value-of select=\"tmarc:sc\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n </pz:metadata>\r\n  <pz:metadata type=\"available\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:ss = \'N\'\">Available</xsl:when>\r\n            <xsl:when test=\"tmarc:ss != \'N\'\">\r\n              <xsl:choose>\r\n       <xsl:when test=\"tmarc:sd\">\r\n                  <xsl:value-of select=\"tmarc:sd\"/>\r\n       </xsl:when>\r\n     <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n              </xsl:choose>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n </pz:metadata>      \r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d948\">\r\n        <pz:metadata type=\"holding\">\r\n          <xsl:for-each select=\"tmarc:s\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text> </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d991\">\r\n        <pz:metadata type=\"holding\">\r\n          <xsl:for-each select=\"tmarc:s\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text> </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d999\">\r\n        <pz:metadata type=\"localid\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sa\">\r\n              <xsl:value-of select=\"tmarc:sa\"/>\r\n            </xsl:when>\r\n            <xsl:when test=\"tmarc:sc\">\r\n              <xsl:value-of select=\"tmarc:sc\"/>\r\n            </xsl:when> \r\n            <xsl:otherwise>\r\n              <xsl:value-of select=\"tmarc:sd\"/>\r\n            </xsl:otherwise>\r\n          </xsl:choose>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n\r\n      <!-- passthrough id data -->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n        <xsl:copy-of select=\".\" />\r\n      </xsl:for-each>\r\n\r\n      <!-- other stylesheets importing this might want to define this -->\r\n <xsl:call-template name=\"record-hook\" />\r\n\r\n    </pz:record>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"text()\" />\r\n\r\n  <!-- TODO Does not work anymore -->\r\n  <xsl:template name=\"shortTitle\">\r\n    <xsl:param name=\"tag\" />\r\n    <xsl:for-each select=\"tmarc:d\">\r\n      <xsl:value-of select=\"tmarc:sa\" />\r\n      <xsl:value-of select=\"tmarc:sm\" />\r\n      <xsl:value-of select=\"tmarc:sn\" />\r\n      <xsl:value-of select=\"tmarc:sp\" />\r\n      <xsl:value-of select=\"tmarc:sr\" />\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n\r\n  <!-- No working as expected -->\r\n  <xsl:template name=\"description\">\r\n    <xsl:param name=\"element\" />\r\n    <xsl:for-each select=\"$element\">\r\n      <pz:metadata type=\"description\">\r\n        <xsl:for-each select=\"node()\">\r\n          <xsl:value-of select=\"text()\" />\r\n        </xsl:for-each>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n    <xsl:apply-templates />\r\n  </xsl:template>\r\n\r\n  <!-- <xsl:for-each select=\"tmarc:d500\"> <pz:metadata type=\"description\"> \r\n    <xsl:for-each select=\"node()\"> <xsl:value-of select=\"text()\"/> </xsl:for-each> \r\n    </pz:metadata> </xsl:for-each> -->\r\n\r\n  <xsl:template name=\"subject\">\r\n    <xsl:param name=\"element\" />\r\n    <xsl:for-each select=\"$element\">\r\n      <pz:metadata type=\"subject\">\r\n        <xsl:value-of select=\"tmarc:sa\" />\r\n      </pz:metadata>\r\n      <pz:metadata type=\"subject-long\">\r\n        <xsl:for-each select=\"node()/text()\">\r\n          <xsl:if test=\"position() > 1\">\r\n            <xsl:text>, </xsl:text>\r\n          </xsl:if>\r\n          <xsl:value-of select=\".\" />\r\n        </xsl:for-each>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n</xsl:stylesheet>\r\n'),(3153,'BasicTransformationStep','<Description>',NULL,'GPDC to MARC21','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"1.0\" \r\n        xmlns:dc=\"http://purl.org/dc/elements/1.1/\" \r\n      xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n       xmlns=\"http://www.loc.gov/MARC21/slim\" \r\n       xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" exclude-result-prefixes=\"dc\" \r\n      xmlns:pgterms=\"http://www.gutenberg.org/rdfterms/\">\r\n    <xsl:output method=\"xml\" indent=\"yes\"/>\r\n    <xsl:strip-space elements=\"pgterms:file\"/>\r\n    <xsl:template match=\"/\">\r\n      <collection>\r\n    <xsl:apply-templates />\r\n      </collection>\r\n    </xsl:template>\r\n    <xsl:template match=\"rdf:Description\">\r\n      <xsl:comment>\r\n    <xsl:value-of select=\".\" />\r\n      </xsl:comment>\r\n    </xsl:template>\r\n    <xsl:template match=\"pgterms:etext\">\r\n        <record>\r\n            <xsl:element name=\"leader\">\r\n                <xsl:variable name=\"type\" select=\"dc:type\"/>\r\n                <xsl:variable name=\"leader06\">\r\n                    <xsl:choose>\r\n                        <xsl:when test=\"$type=\'collection\'\">p</xsl:when>\r\n                        <xsl:when test=\"$type=\'dataset\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'event\'\">r</xsl:when>\r\n                        <xsl:when test=\"$type=\'image\'\">k</xsl:when>\r\n                        <xsl:when test=\"$type=\'interactive resource\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'service\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'software\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'sound\'\">i</xsl:when>\r\n                        <xsl:when test=\"$type=\'text\'\">a</xsl:when>\r\n                        <xsl:otherwise>a</xsl:otherwise>\r\n                    </xsl:choose>\r\n                </xsl:variable>\r\n                <xsl:variable name=\"leader07\">\r\n                    <xsl:choose>\r\n                        <xsl:when test=\"$type=\'collection\'\">c</xsl:when>\r\n                        <xsl:otherwise>m</xsl:otherwise>\r\n                    </xsl:choose>\r\n                </xsl:variable>\r\n                <xsl:value-of select=\"concat(\'      \',$leader06,$leader07,\'         3u     \')\"/>\r\n            </xsl:element>\r\n        <controlfield tag=\"001\">\r\n        <xsl:value-of select=\"substring(@rdf:ID, 6)\"/>\r\n      </controlfield>\r\n     <datafield tag=\"856\" ind1=\"0\" ind2=\"0\">\r\n         <subfield code=\"u\">http://www.gutenberg.org/ebooks/<xsl:value-of select=\"substring(@rdf:ID, 6)\"/></subfield>\r\n      </datafield>\r\n\r\n            <xsl:for-each select=\"dc:contributer\">\r\n                <datafield tag=\"720\" ind1=\"0\" ind2=\"0\">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                    <subfield code=\"e\">collaborator</subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:coverage\">\r\n                <datafield tag=\"500\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:creator\">\r\n                <datafield tag=\"100\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n<!--\r\n                    <subfield code=\"e\">author</subfield>\r\n-->\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:date\">\r\n                <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"c\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>    \r\n\r\n            <xsl:for-each select=\"dc:description\">\r\n                <datafield tag=\"520\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:identifier\">\r\n                <datafield tag=\"856\" ind1=\"4\" ind2=\"0\">\r\n                    <subfield code=\"u\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n         <xsl:if test=\"dc:format\">\r\n           <subfield code=\"q\">\r\n             <xsl:value-of select=\"dc:format\"/>\r\n              </subfield>\r\n           </xsl:if>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:language\">\r\n                <datafield tag=\"546\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:publisher\">\r\n                <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"b\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:relation\">\r\n                <datafield tag=\"787\" ind1=\"0\" ind2=\" \">\r\n                    <subfield code=\"n\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:rights\">\r\n                <datafield tag=\"540\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:source\">\r\n                <datafield tag=\"786\" ind1=\"0\" ind2=\" \">\r\n                    <subfield code=\"n\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <datafield tag=\"650\" ind1=\" \" ind2=\" \">\r\n       <xsl:for-each select=\"dc:subject\">\r\n<!--          <xsl:for-each select=\"tokenize(.,\';|- -\')\"> -->\r\n           <subfield code=\"a\"><xsl:value-of select=\"normalize-space(.)\" /></subfield>\r\n<!--            </xsl:for-each> -->\r\n              </xsl:for-each>\r\n        </datafield>\r\n\r\n            <xsl:for-each select=\"dc:title[1]\">\r\n                <datafield tag=\"245\" ind1=\"0\" ind2=\"0\">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:title[position()>1]\">\r\n                <datafield tag=\"246\" ind1=\"3\" ind2=\"3\"><subfield code=\"a\"><xsl:value-of select=\".\"/></subfield></datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:type\">\r\n                <datafield tag=\"655\" ind1=\"7\" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                    <subfield code=\"2\">local</subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n        </record>\r\n    </xsl:template>\r\n  <!-- Ignore other elements by mapping into empty DOM XML trees -->\r\n<!--\r\n  <xsl:template match=\"/*\"/>\r\n-->\r\n  <xsl:template match=\"pgterms:file\" />\r\n\r\n</xsl:stylesheet>\r\n'),(3155,'BasicTransformationStep','<Description>',NULL,'DC to MARC21 (slim)','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns=\"http://www.loc.gov/MARC21/slim\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" exclude-result-prefixes=\"dc\">\r\n    <xsl:output method=\"xml\" indent=\"yes\"/>\r\n \r\n    <xsl:template match=\"/\">\r\n      <record xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd\" >\r\n          <xsl:element name=\"leader\">\r\n               <xsl:variable name=\"type\" select=\"dc:type\"/>\r\n                <xsl:variable name=\"leader06\">\r\n                    <xsl:choose>\r\n                        <xsl:when test=\"$type=\'collection\'\">p</xsl:when>\r\n                        <xsl:when test=\"$type=\'dataset\'\">m</xsl:when>\r\n                       <xsl:when test=\"$type=\'event\'\">r</xsl:when>\r\n                     <xsl:when test=\"$type=\'image\'\">k</xsl:when>\r\n                     <xsl:when test=\"$type=\'interactive resource\'\">m</xsl:when>\r\n                      <xsl:when test=\"$type=\'service\'\">m</xsl:when>\r\n                       <xsl:when test=\"$type=\'software\'\">m</xsl:when>\r\n                      <xsl:when test=\"$type=\'sound\'\">i</xsl:when>\r\n                     <xsl:when test=\"$type=\'text\'\">a</xsl:when>\r\n                      <xsl:otherwise>a</xsl:otherwise>\r\n                    </xsl:choose>\r\n               </xsl:variable>\r\n             <xsl:variable name=\"leader07\">\r\n                    <xsl:choose>\r\n                        <xsl:when test=\"$type=\'collection\'\">c</xsl:when>\r\n                        <xsl:otherwise>m</xsl:otherwise>\r\n                    </xsl:choose>\r\n               </xsl:variable>\r\n             <xsl:value-of select=\"concat(\'      \',$leader06,$leader07,\'         3u     \')\"/>\r\n          </xsl:element>\r\n\r\n          <datafield tag=\"042\" ind1=\" \" ind2=\" \">\r\n               <subfield code=\"a\">dc</subfield>\r\n          </datafield>\r\n\r\n            <xsl:for-each select=\"//dc:contributer\">\r\n              <datafield tag=\"720\" ind1=\"0\" ind2=\"0\">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                 <subfield code=\"e\">collaborator</subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:coverage\">\r\n             <datafield tag=\"500\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:creator\">\r\n              <datafield tag=\"720\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                 <subfield code=\"e\">author</subfield>\r\n              </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:date\">\r\n             <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"c\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each> \r\n\r\n            <xsl:for-each select=\"//dc:description\">\r\n              <datafield tag=\"520\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n         \r\n            <xsl:for-each select=\"//dc:format\">\r\n               <datafield tag=\"856\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"q\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:identifier\">\r\n               <datafield tag=\"024\" ind1=\"8\" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:language\">\r\n             <datafield tag=\"546\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n         \r\n            <xsl:for-each select=\"//dc:publisher\">\r\n                <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"b\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:relation\">\r\n             <datafield tag=\"787\" ind1=\"0\" ind2=\" \">\r\n                   <subfield code=\"n\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:rights\">\r\n               <datafield tag=\"540\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:source\">\r\n               <datafield tag=\"786\" ind1=\"0\" ind2=\" \">\r\n                   <subfield code=\"n\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:subject\">\r\n              <datafield tag=\"653\" ind1=\" \" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n                                                                                         \r\n            <xsl:for-each select=\"//dc:title[1]\">\r\n             <datafield tag=\"245\" ind1=\"0\" ind2=\"0\">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:title[position()>1]\">\r\n              <datafield tag=\"246\" ind1=\"3\" ind2=\"3\">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n             </datafield>\r\n            </xsl:for-each>\r\n\r\n         <xsl:for-each select=\"//dc:type\">\r\n             <datafield tag=\"655\" ind1=\"7\" ind2=\" \">\r\n                   <subfield code=\"a\">\r\n                       <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                 <subfield code=\"2\">local</subfield>\r\n               </datafield>\r\n            </xsl:for-each>\r\n     </record>\r\n   </xsl:template>\r\n</xsl:stylesheet>'),(3208,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(3258,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(3353,'BasicTransformationStep','<Description>',NULL,'MARC21 to PZ2','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\">\r\n  \r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\"/>\r\n\r\n<!-- Extract metadata from MARC21/USMARC \r\n      http://www.loc.gov/marc/bibliographic/ecbdhome.html\r\n-->  \r\n  <xsl:template name=\"record-hook\"/>\r\n\r\n  <xsl:template match=\"/\">\r\n    <xsl:apply-templates/>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"marc:record\">\r\n    <xsl:variable name=\"title_medium\" select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'h\']\"/>\r\n    <xsl:variable name=\"journal_title\" select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\"/>\r\n    <xsl:variable name=\"electronic_location_url\" select=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'u\']\"/>\r\n    <xsl:variable name=\"fulltext_a\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\"/>\r\n    <xsl:variable name=\"fulltext_b\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\"/>\r\n    <xsl:variable name=\"medium\">\r\n      <xsl:choose>\r\n    <xsl:when test=\"$title_medium\">\r\n     <xsl:value-of select=\"translate($title_medium, \' []/\', \'\')\"/>\r\n   </xsl:when>\r\n <xsl:when test=\"$fulltext_a\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$fulltext_b\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$journal_title\">\r\n    <xsl:text>article</xsl:text>\r\n  </xsl:when>\r\n <xsl:otherwise>\r\n   <xsl:text>book</xsl:text>\r\n </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"has_fulltext\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'q\']\">\r\n          <xsl:text>yes</xsl:text>\r\n        </xsl:when>\r\n        <xsl:when test=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'i\']=\'TEXT*\'\">\r\n          <xsl:text>yes</xsl:text>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:text>no</xsl:text>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>\r\n      <xsl:for-each select=\"marc:controlfield[@tag=\'001\']\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'010\']\">\r\n        <pz:metadata type=\"lccn\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'020\']\">\r\n        <pz:metadata type=\"isbn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'022\']\">\r\n        <pz:metadata type=\"issn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'027\']\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'035\']\">\r\n        <pz:metadata type=\"system-control-nr\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"marc:subfield[@code=\'a\']\">\r\n              <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>\r\n              <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n            </xsl:otherwise>\r\n          </xsl:choose>\r\n  </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'100\']\">\r\n <pz:metadata type=\"author\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-date\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'110\']\">\r\n <pz:metadata type=\"corporate-name\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"corporate-location\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"corporate-date\">\r\n       <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'111\']\">\r\n <pz:metadata type=\"meeting-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"meeting-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n  <pz:metadata type=\"meeting-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n <pz:metadata type=\"date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'245\']\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'h\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'n\']\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'250\']\">\r\n <pz:metadata type=\"edition\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n        <pz:metadata type=\"publication-place\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'300\']\">\r\n <pz:metadata type=\"physical-extent\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-format\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-dimensions\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-accomp\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'e\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unittype\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unitsize\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-specified\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'3\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'440\']\">\r\n <pz:metadata type=\"series-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag = \'500\' or @tag = \'505\' or\r\n              @tag = \'518\' or @tag = \'520\' or @tag = \'522\']\">\r\n  <pz:metadata type=\"description\">\r\n            <xsl:value-of select=\"*/text()\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n        <pz:metadata type=\"subject\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"subject-long\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text>, </xsl:text>\r\n       </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n   </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'856\']\">\r\n <pz:metadata type=\"electronic-url\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'u\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-text\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'y\' or @code=\'3\']\"/>\r\n  </pz:metadata>\r\n  <pz:metadata type=\"electronic-note\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'z\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-format-instruction\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'i\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-format-type\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'q\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"has-fulltext\">\r\n        <xsl:value-of select=\"$has_fulltext\"/> \r\n      </pz:metadata>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'773\']\">\r\n       <pz:metadata type=\"citation\">\r\n       <xsl:for-each select=\"*\">\r\n           <xsl:value-of select=\"normalize-space(.)\"/>\r\n           <xsl:text> </xsl:text>\r\n        </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"marc:subfield[@code=\'t\']\">\r\n       <pz:metadata type=\"journal-title\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'t\']\"/>\r\n          </pz:metadata>          \r\n        </xsl:if>\r\n        <xsl:if test=\"marc:subfield[@code=\'g\']\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n          </pz:metadata>          \r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'852\']\">\r\n        <xsl:if test=\"marc:subfield[@code=\'y\']\">\r\n     <pz:metadata type=\"publicnote\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'y\']\"/>\r\n     </pz:metadata>\r\n    </xsl:if>\r\n   <xsl:if test=\"marc:subfield[@code=\'h\']\">\r\n      <pz:metadata type=\"callnumber\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'h\']\"/>\r\n     </pz:metadata>\r\n    </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n   <xsl:value-of select=\"$medium\"/>\r\n      </pz:metadata>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\">\r\n <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_a\"/>\r\n    </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\">\r\n    <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_b\"/>\r\n    </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'907\' or @tag=\'901\']\">\r\n        <pz:metadata type=\"iii-id\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'926\']\">\r\n        <pz:metadata type=\"holding\">\r\n     <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'948\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'991\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n       <xsl:if test=\"position() > 1\">\r\n          <xsl:text> </xsl:text>\r\n        </xsl:if>\r\n       <xsl:value-of select=\".\"/>\r\n      </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- passthrough id data -->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n          <xsl:copy-of select=\".\"/>\r\n      </xsl:for-each>\r\n\r\n      <!-- other stylesheets importing this might want to define this -->\r\n      <xsl:call-template name=\"record-hook\"/>\r\n\r\n    </pz:record>    \r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>\r\n'),(3403,'BasicTransformationStep','<Description>',NULL,'Step 1','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>'),(3405,'BasicTransformationStep','<Description>',NULL,'Step 2','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>'),(3458,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(3508,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(3520,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>'),(3558,'BasicTransformationStep','Test Description',NULL,'Test Transformation','<?xml version=\"1.0\" ?>');
/*!40000 ALTER TABLE `STEP` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `STORAGE`
--

DROP TABLE IF EXISTS `STORAGE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `STORAGE` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `CURRENTSTATUS` varchar(4096) DEFAULT NULL,
  `NAME` varchar(255) DEFAULT NULL,
  `MESSAGE` varchar(4096) DEFAULT NULL,
  `TRANSFORMATION` varchar(100) DEFAULT NULL,
  `DESCRIPTION` varchar(4096) DEFAULT NULL,
  `URL` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `STORAGE`
--

LOCK TABLES `STORAGE` WRITE;
/*!40000 ALTER TABLE `STORAGE` DISABLE KEYS */;
INSERT INTO `STORAGE` VALUES (102,'SolrStorage',1,'TODO','Solr (tomcat) @ localhost',NULL,NULL,'Dont use localhost, unless the metasearcher also runs there. This is for testing.','http://localhost:8080/solr');
/*!40000 ALTER TABLE `STORAGE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `TRANSFORMATION`
--

DROP TABLE IF EXISTS `TRANSFORMATION`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `TRANSFORMATION` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `DESCRIPTION` varchar(4096) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `NAME` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `TRANSFORMATION`
--

LOCK TABLES `TRANSFORMATION` WRITE;
/*!40000 ALTER TABLE `TRANSFORMATION` DISABLE KEYS */;
INSERT INTO `TRANSFORMATION` VALUES (10,'BasicTransformation','Converting from OAI-PMH(DC) to PZ',1,'OAI-PMH(DC) to PZ'),(20,'BasicTransformation','Converting from OAI-PMH(MARCXML) to PZ',1,'OAI-PMH(MARCXML) to PZ'),(2953,'BasicTransformation','',1,'Marc XML'),(2954,'BasicTransformation','Converts from Turbo Marc XML to PZ',1,'Turbo Marc'),(3102,'BasicTransformation','Gutenberg to PZ2',1,'Gutenberg'),(3103,'BasicTransformation','',1,'DC to MARC21 (slim)');
/*!40000 ALTER TABLE `TRANSFORMATION` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `TRANSFORMATION_STEP`
--

DROP TABLE IF EXISTS `TRANSFORMATION_STEP`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `TRANSFORMATION_STEP` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `POSITION` int(11) DEFAULT NULL,
  `TRANSFORMATION_ID` bigint(20) DEFAULT NULL,
  `STEP_ID` bigint(20) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  UNIQUE KEY `UNQ_TRANSFORMATION_STEP_0` (`TRANSFORMATION_ID`,`STEP_ID`),
  KEY `FK_TRANSFORMATION_STEP_STEP_ID` (`STEP_ID`),
  CONSTRAINT `FK_TRANSFORMATION_STEP_STEP_ID` FOREIGN KEY (`STEP_ID`) REFERENCES `STEP` (`ID`),
  CONSTRAINT `FK_TRANSFORMATION_STEP_TRANSFORMATION_ID` FOREIGN KEY (`TRANSFORMATION_ID`) REFERENCES `TRANSFORMATION` (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `TRANSFORMATION_STEP`
--

LOCK TABLES `TRANSFORMATION_STEP` WRITE;
/*!40000 ALTER TABLE `TRANSFORMATION_STEP` DISABLE KEYS */;
INSERT INTO `TRANSFORMATION_STEP` VALUES (1,'TransformationStepAssociation',1,10,10),(2,'TransformationStepAssociation',1,20,20),(3,'TransformationStepAssociation',2,20,22),(3002,'TransformationStepAssociation',1,2953,22),(3004,'TransformationStepAssociation',1,2954,3005),(3152,'TransformationStepAssociation',1,3102,3153),(3154,'TransformationStepAssociation',1,3103,3155),(3259,'TransformationStepAssociation',2,NULL,3258),(3352,'TransformationStepAssociation',2,3102,3353),(3509,'TransformationStepAssociation',2,NULL,3508),(3521,'TransformationStepAssociation',2,NULL,3520);
/*!40000 ALTER TABLE `TRANSFORMATION_STEP` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2011-09-16 14:45:57
</pre>

<h2>Automaction Start</h2>
<p>
Configuring Tomcat and MySQL to automatic start-up:  
</p>
<pre class="code">chkconfig --level 345 httpd on
chkconfig --level 345 tomcat6 on
chkconfig --level 345 mysql on
</pre>

<h2>User Authentication</h2>
The Harvester Admin requires a installed Torus for authencitations. Edit the /usr/share/masterkey/harvester-admin/WEB-INF/web.xml:
<pre>
        &lt;init-param&gt;
            &lt;param-name&gt;USER_TORUS_URI&lt;/param-name&gt;
            &lt;param-value&gt;http://mk2-test.indexdata.com/torus/identity/records/USERS/&lt;/param-value&gt;
        &lt;/init-param&gt;
</pre>

to point to a torus that contains the users, that are allowed to use the harvester. 
</body>
</html>
