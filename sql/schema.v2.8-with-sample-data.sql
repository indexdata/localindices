-- MySQL dump 10.13  Distrib 5.6.23, for osx10.10 (x86_64)
--
-- Host: localhost    Database: localindices
-- ------------------------------------------------------
-- Server version	5.6.23

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `HARVESTABLE`
--

DROP TABLE IF EXISTS `HARVESTABLE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `HARVESTABLE` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `LASTUPDATED` datetime DEFAULT NULL,
  `DESCRIPTION` mediumtext,
  `INITIALLYHARVESTED` datetime DEFAULT NULL,
  `TECHNICALNOTES` mediumtext,
  `LASTHARVESTSTARTED` datetime DEFAULT NULL,
  `SCHEDULESTRING` varchar(255) DEFAULT NULL,
  `LASTHARVESTFINISHED` datetime DEFAULT NULL,
  `NAME` varchar(255) DEFAULT NULL,
  `CURRENTSTATUS` varchar(255) DEFAULT NULL,
  `CONTACTNOTES` mediumtext,
  `AMOUNTHARVESTED` int(11) DEFAULT NULL,
  `SERVICEPROVIDER` varchar(255) DEFAULT NULL,
  `MESSAGE` mediumtext,
  `MAXDBSIZE` int(11) DEFAULT NULL,
  `HARVESTIMMEDIATELY` tinyint(1) NOT NULL DEFAULT '0',
  `FILETYPEMASKS` varchar(255) DEFAULT NULL,
  `URIMASKS` varchar(255) DEFAULT NULL,
  `STARTURLS` mediumtext,
  `RECURSIONDEPTH` int(11) DEFAULT NULL,
  `EXPECTEDSCHEMA` varchar(255) DEFAULT NULL,
  `URL` mediumtext,
  `NORMALIZATIONFILTER` varchar(255) DEFAULT NULL,
  `SCHEMAURI` varchar(255) DEFAULT NULL,
  `OAISETNAME` varchar(255) DEFAULT NULL,
  `FROMDATE` datetime DEFAULT NULL,
  `UNTILDATE` datetime DEFAULT NULL,
  `METADATAPREFIX` varchar(255) DEFAULT NULL,
  `DATEFORMAT` varchar(255) DEFAULT NULL,
  `RESUMPTIONTOKEN` varchar(255) DEFAULT NULL,
  `STORAGE_ID` bigint(20) DEFAULT NULL,
  `TRANSFORMATION_ID` bigint(20) DEFAULT NULL,
  `OVERWRITE` tinyint(1) DEFAULT NULL,
  `SPLITAT` varchar(255) DEFAULT NULL,
  `SPLITSIZE` varchar(255) DEFAULT NULL,
  `OUTPUTSCHEMA` mediumtext,
  `ENCODING` varchar(255) DEFAULT NULL,
  `CLIENTCLASS` varchar(255) DEFAULT NULL,
  `USERNAME` varchar(255) DEFAULT NULL,
  `PASSWORD` varchar(255) DEFAULT NULL,
  `PROXY` varchar(255) DEFAULT NULL,
  `SCRIPT` longtext,
  `ISPERSISTENCE` tinyint(1) DEFAULT NULL,
  `INITDATA` mediumtext,
  `SLEEP` int(11) DEFAULT NULL,
  `CONNECTORURL` mediumtext,
  `ALLOWERRORS` tinyint(4) DEFAULT NULL,
  `ALLOWCONDREQ` tinyint(4) DEFAULT NULL,
  `CLEARRTONERROR` tinyint(1) NOT NULL DEFAULT '0',
  `KEEPPARTIAL` tinyint(1) NOT NULL DEFAULT '1',
  `TIMEOUT` smallint(6) NOT NULL DEFAULT '300',
  `RETRYCOUNT` tinyint(3) NOT NULL DEFAULT '2',
  `RETRYWAIT` smallint(4) NOT NULL DEFAULT '60',
  `LOGLEVEL` varchar(30) DEFAULT NULL,
  `MAILLEVEL` varchar(30) DEFAULT NULL,
  `MAILADDRESS` varchar(1000) DEFAULT NULL,
  `RECORDLIMIT` bigint(20) DEFAULT NULL,
  `DISKRUN` tinyint(1) NOT NULL DEFAULT '0',
  `CACHEENABLED` tinyint(1) NOT NULL DEFAULT '0',
  `ENGINEPARAMETERS` varchar(4096) DEFAULT NULL,
  `CONNECTORENGINEURLSETTING_ID` bigint(20) DEFAULT NULL,
  `CONNECTORREPOURLSETTING_ID` bigint(20) DEFAULT NULL,
  `OPENACCESS` tinyint(1) NOT NULL DEFAULT '0',
  `ORIGINALURI` varchar(1024) DEFAULT NULL,
  `JSON` text,
  `LAXPARSING` tinyint(1) NOT NULL DEFAULT '0',
  `PASSIVEMODE` tinyint(1) NOT NULL DEFAULT '0',
  `RECURSIONLEVELS` tinyint(2) NOT NULL DEFAULT '0',
  `CSVCONFIGURATION` varchar(1024) DEFAULT NULL,
  `EXCLUDEFILEPATTERN` varchar(1024) DEFAULT NULL,
  `INCLUDEFILEPATTERN` varchar(1024) DEFAULT NULL,
  `STORAGEBATCHLIMIT` smallint(4) DEFAULT NULL,
  `MANAGEDBY` varchar(1024) DEFAULT NULL,
  `USEDBY` varchar(1024) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `FK_HARVESTABLE_STORAGE_ID` (`STORAGE_ID`),
  CONSTRAINT `FK_HARVESTABLE_STORAGE_ID` FOREIGN KEY (`STORAGE_ID`) REFERENCES `STORAGE` (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;


LOCK TABLES `HARVESTABLE` WRITE;
/*!40000 ALTER TABLE `HARVESTABLE` DISABLE KEYS */;
INSERT INTO `HARVESTABLE` VALUES (9999, 'XmlBulkResource',1,'2014-09-24 08:33:27','','2011-12-28 21:22:32','','2015-06-10 10:10:00','10 10 10 6 *','2015-06-10 10:32:11','Test data'        ,'OK','',NULL, 'Index Data',NULL,NULL,0,NULL,NULL,NULL,NULL,'','http://localhost:8080/test/oai2instance.xml',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,104,9131,1,'1','1000','',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,NULL,0,1,60,2,60,'DEBUG','WARN','',NULL,0,0,NULL,1,2,1,NULL,'{  \r\n  \"folioTenant\": \"diku\",\r\n  \"folioUsername\": \"diku_admin\",\r\n  \"folioPassword\": \"admin\"\r\n}',0,0,0,NULL,NULL,NULL,NULL,NULL,NULL);
INSERT INTO `HARVESTABLE` VALUES (10000,'XmlBulkResource',1,'2014-09-24 08:33:27','','2011-12-28 21:22:32','','2015-06-10 10:10:00','10 10 10 6 *','2015-06-10 10:32:11','Millersville OAI-PMH sample'        ,'OK','',NULL, 'Index Data',NULL,NULL,0,NULL,NULL,NULL,NULL,'','http://localhost:8080/test/alma_oai_output.xml',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,104,9131,1,'1','1000','',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,NULL,0,1,60,2,60,'DEBUG','WARN','',NULL,0,0,NULL,1,2,1,NULL,'{  \r\n  \"folioTenant\": \"diku\",\r\n  \"folioUsername\": \"diku_admin\",\r\n  \"folioPassword\": \"admin\"\r\n}',0,0,0,NULL,NULL,NULL,NULL,NULL,NULL);

/*!40000 ALTER TABLE `HARVESTABLE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `SEQUENCE`
--

DROP TABLE IF EXISTS `SEQUENCE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SEQUENCE` (
  `SEQ_NAME` varchar(50) NOT NULL,
  `SEQ_COUNT` decimal(38,0) DEFAULT NULL,
  PRIMARY KEY (`SEQ_NAME`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;


LOCK TABLES `SEQUENCE` WRITE;
/*!40000 ALTER TABLE `SEQUENCE` DISABLE KEYS */;
INSERT INTO `SEQUENCE` VALUES ('SEQ_GEN',10000);
/*!40000 ALTER TABLE `SEQUENCE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `SETTING`
--

DROP TABLE IF EXISTS `SETTING`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SETTING` (
  `ID` bigint(20) NOT NULL,
  `NAME` varchar(4096) NOT NULL,
  `LABEL` varchar(4096) NOT NULL,
  `VALUE` varchar(4096) DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;


LOCK TABLES `SETTING` WRITE;
/*!40000 ALTER TABLE `SETTING` DISABLE KEYS */;
INSERT INTO `SETTING` VALUES (1,'cf.engine.url.1','CF Engine (default)','http://arya.indexdata.com:9003/connector'),(2,'cf.repo.url.1','CF Repo (default)','https://idtest:idtest36@cfrepo.indexdata.com/repo.pl/idtest/'),(5552,'cf.repo.url.2','CF Repo (harvest)','https://harvest:corn@cfrepo.indexdata.com/repo.pl/harvest/'),(5602,'cf.repo.url.3','Google','http://www.google.com/');
/*!40000 ALTER TABLE `SETTING` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `STEP`
--

DROP TABLE IF EXISTS `STEP`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `STEP` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `DESCRIPTION` varchar(4096) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `NAME` varchar(255) DEFAULT NULL,
  `SCRIPT` text,
  `TYPE` varchar(255) DEFAULT NULL,
  `OUTPUTFORMAT` varchar(255) DEFAULT NULL,
  `INPUTFORMAT` varchar(255) DEFAULT NULL,
  `CUSTOMCLASS` varchar(255) DEFAULT NULL,
  `TESTDATA` text,
  `TESTOUTPUT` text,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `STEP` WRITE;
/*!40000 ALTER TABLE `STEP` DISABLE KEYS */;
INSERT INTO `STEP` VALUES (10,'XmlTransformationStep','Missing non-protocol filtering ',1,'OAIPMH-DC to PZ','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!--\r\n\r\n    This stylesheet expects oai/dc records\r\n-->\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:oai=\"http://www.openarchives.org/OAI/2.0/\"\r\n    xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n    xmlns:dcterms=\"http://purl.org/dc/terms/\">\r\n\r\n  <xsl:output indent=\"yes\"\r\n              method=\"xml\"\r\n              version=\"1.0\"\r\n              encoding=\"UTF-8\"/>\r\n\r\n  <xsl:template match=\"/oai:OAI-PMH\">\r\n    <xsl:apply-templates/>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"oai:ListRecords\">\r\n    <pz:collection>\r\n      <xsl:apply-templates/>\r\n    </pz:collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"oai:record\">\r\n    <pz:record>\r\n      <pz:metadata type=\"id\">\r\n        <xsl:value-of select=\"oai:header/oai:identifier\"/>\r\n      </pz:metadata>\r\n      <xsl:if test=\"oai:header[@status=\'deleted\']\">\r\n <pz:metadata type=\"record_status\">deleted</pz:metadata>\r\n      </xsl:if>\r\n      <xsl:apply-templates/>\r\n    </pz:record>\r\n  </xsl:template>\r\n    \r\n  <xsl:template match=\"oai:metadata/*\">\r\n    <xsl:for-each select=\"dc:title\">\r\n      <pz:metadata type=\"title\">\r\n        <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n\r\n    <xsl:for-each select=\"dc:date\">\r\n      <pz:metadata type=\"date\">\r\n <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n\r\n    <xsl:for-each select=\"dc:subject\">\r\n      <pz:metadata type=\"subject\">\r\n <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n\r\n    <xsl:for-each select=\"dc:creator\">\r\n      <pz:metadata type=\"author\">\r\n        <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n\r\n    <xsl:for-each select=\"dc:description\">\r\n      <pz:metadata type=\"description\">\r\n <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n\r\n    <xsl:for-each select=\"dc:identifier\">\r\n      <pz:metadata type=\"electronic-url\">\r\n <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n\r\n    <xsl:for-each select=\"dc:type\">\r\n      <pz:metadata type=\"medium\">\r\n <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n      \r\n    <xsl:for-each select=\"dcterms:bibliographicCitation\">\r\n      <pz:metadata type=\"citation\">\r\n        <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>','','','','PZ','OAI-PMH(DC)',NULL),(20,'XmlTransformationStep','',1,'OAIPMH-MARC to MARC21','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!--\r\n\r\n    This stylesheet pulls out marc records from the oai-pmh response\r\n    and overwrites the controlfield 001 with oai-identifier\r\n-->\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:oai=\"http://www.openarchives.org/OAI/2.0/\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    exclude-result-prefixes=\"oai\">\r\n\r\n\r\n <xsl:output indent=\"yes\"\r\n        method=\"xml\"\r\n        version=\"1.0\"\r\n        encoding=\"UTF-8\"/>\r\n\r\n\r\n<xsl:template match=\"/\">\r\n<collection>\r\n  <xsl:apply-templates/>\r\n</collection>\r\n\r\n</xsl:template>\r\n\r\n  <xsl:template match=\"//oai:record\">\r\n    <xsl:if test=\"oai:header[@status=\'deleted\']\">\r\n      <delete><xsl:attribute name=\"id\"><xsl:value-of select=\"oai:header/oai:identifier\"/></xsl:attribute></delete>\r\n    </xsl:if>\r\n    <xsl:if test=\"not(oai:header[@status=\'deleted\'])\">\r\n      <xsl:variable name=\"oai-id\">\r\n          <xsl:value-of select=\"oai:header/oai:identifier\"/>\r\n      </xsl:variable>\r\n\r\n      <xsl:for-each select=\"oai:metadata/marc:record\">\r\n        <xsl:copy>\r\n          <xsl:copy-of select=\"@*\"/>\r\n          <xsl:copy-of select=\"*\"/>\r\n          <pz:metadata type=\"id\">\r\n           <xsl:value-of select=\"$oai-id\"/>\r\n          </pz:metadata>\r\n        </xsl:copy>\r\n      </xsl:for-each>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>','','','','MARCXML','OAIPMH(MARC)',NULL),(22,'XmlTransformationStep','Convert MARCXML to PZ',1,'MARC21 to PZ','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\">\r\n\r\n  \r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\"/>\r\n\r\n<!-- Extract metadata from MARC21/USMARC \r\n      http://www.loc.gov/marc/bibliographic/ecbdhome.html\r\n-->  \r\n  <xsl:include href=\"pz2-ourl-marc21.xsl\" />\r\n\r\n  <xsl:template match=\"/\">\r\n    <pz:collection> \r\n      <xsl:apply-templates />\r\n    </pz:collection>\r\n  </xsl:template>        \r\n  \r\n  <xsl:template match=\"//delete\">\r\n <xsl:copy-of select=\".\"/>                                                                                                                                                                               \r\n  </xsl:template> \r\n  \r\n  <xsl:template match=\"//marc:record\">\r\n    <xsl:variable name=\"title_medium\" select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'h\']\"/>\r\n    <xsl:variable name=\"journal_title\" select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\"/>\r\n    <xsl:variable name=\"electronic_location_url\" select=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'u\']\"/>\r\n    <xsl:variable name=\"fulltext_a\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\"/>\r\n    <xsl:variable name=\"fulltext_b\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\"/>\r\n    <xsl:variable name=\"medium\">\r\n      <xsl:choose>\r\n  <xsl:when test=\"$title_medium\">\r\n   <xsl:value-of select=\"substring-after(substring-before($title_medium,\']\'),\'[\')\"/>\r\n </xsl:when>\r\n <xsl:when test=\"$fulltext_a\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$fulltext_b\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$journal_title\">\r\n    <xsl:text>article</xsl:text>\r\n  </xsl:when>\r\n <xsl:otherwise>\r\n   <xsl:text>book</xsl:text>\r\n </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>      \r\n      <xsl:for-each select=\"marc:controlfield[@tag=\'001\']\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'010\']\">\r\n        <pz:metadata type=\"lccn\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'020\']\">\r\n        <pz:metadata type=\"isbn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'022\']\">\r\n        <pz:metadata type=\"issn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'027\']\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'035\']\">\r\n        <pz:metadata type=\"system-control-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'100\']\">\r\n <pz:metadata type=\"author\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-date\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'110\']\">\r\n <pz:metadata type=\"corporate-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"corporate-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"corporate-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'111\']\">\r\n <pz:metadata type=\"meeting-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"meeting-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"meeting-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n <pz:metadata type=\"date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'245\']\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'h\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'n\']\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'250\']\">\r\n <pz:metadata type=\"edition\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n        <pz:metadata type=\"publication-place\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'300\']\">\r\n <pz:metadata type=\"physical-extent\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-format\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-dimensions\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-accomp\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'e\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unittype\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unitsize\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-specified\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'3\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'440\']\">\r\n <pz:metadata type=\"series-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag = \'500\' or @tag = \'505\' or @tag = \'518\' or @tag = \'520\' or @tag = \'522\']\">\r\n <pz:metadata type=\"description\">\r\n            <xsl:value-of select=\"*/text()\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n        <pz:metadata type=\"subject\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"subject-long\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text>, </xsl:text>\r\n     </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'856\']\">\r\n <pz:metadata type=\"electronic-url\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'u\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-text\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'y\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-note\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'z\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'773\']\">\r\n        <pz:metadata type=\"citation\">\r\n          <xsl:for-each select=\"*\">\r\n            <xsl:value-of select=\"normalize-space(.)\"/>\r\n            <xsl:text> </xsl:text>\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"marc:subfield[@code=\'t\']\">\r\n          <pz:metadata type=\"journal-title\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'t\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"marc:subfield[@code=\'g\']\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n <xsl:value-of select=\"$medium\"/>\r\n      </pz:metadata>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\">\r\n <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_a\"/>\r\n  </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\">\r\n  <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_b\"/>\r\n  </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'907\' or @tag=\'901\']\">\r\n        <pz:metadata type=\"iii-id\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'926\']\">\r\n        <pz:metadata type=\"holding\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'948\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'991\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:if test=\"$open_url_resolver\">\r\n        <pz:metadata type=\"open-url\">\r\n            <xsl:call-template name=\"insert-md-openurl\" />\r\n        </pz:metadata>\r\n      </xsl:if>\r\n\r\n      <!--passthrough id data-->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n          <xsl:copy-of select=\".\"/>\r\n      </xsl:for-each>\r\n\r\n    </pz:record>    \r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>','','','','PZ','MARCXML',''),(3003,'XmlTransformationStep','Basede on marc21.xsl',NULL,'Marc XML','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\">\r\n\r\n  \r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\"/>\r\n\r\n<!-- Extract metadata from MARC21/USMARC \r\n      http://www.loc.gov/marc/bibliographic/ecbdhome.html\r\n-->  \r\n  <xsl:include href=\"pz2-ourl-marc21.xsl\" />\r\n\r\n  <xsl:template match=\"/\">\r\n    <pz:collection> \r\n      <xsl:apply-templates />\r\n    </pz:collection>\r\n  </xsl:template>            \r\n  \r\n  <xsl:template match=\"//delete\">\r\n  <xsl:copy-of select=\".\"/>                                                                                                                                                                               \r\n  </xsl:template>            \r\n  \r\n  <xsl:template match=\"//marc:record\">\r\n    <xsl:variable name=\"title_medium\" select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'h\']\"/>\r\n    <xsl:variable name=\"journal_title\" select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\"/>\r\n    <xsl:variable name=\"electronic_location_url\" select=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'u\']\"/>\r\n    <xsl:variable name=\"fulltext_a\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\"/>\r\n    <xsl:variable name=\"fulltext_b\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\"/>\r\n    <xsl:variable name=\"medium\">\r\n      <xsl:choose>\r\n <xsl:when test=\"$title_medium\">\r\n   <xsl:value-of select=\"substring-after(substring-before($title_medium,\']\'),\'[\')\"/>\r\n </xsl:when>\r\n <xsl:when test=\"$fulltext_a\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$fulltext_b\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$journal_title\">\r\n    <xsl:text>article</xsl:text>\r\n  </xsl:when>\r\n <xsl:otherwise>\r\n   <xsl:text>book</xsl:text>\r\n </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>      \r\n      <xsl:for-each select=\"marc:controlfield[@tag=\'001\']\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'010\']\">\r\n        <pz:metadata type=\"lccn\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'020\']\">\r\n        <pz:metadata type=\"isbn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'022\']\">\r\n        <pz:metadata type=\"issn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'027\']\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'035\']\">\r\n        <pz:metadata type=\"system-control-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'100\']\">\r\n <pz:metadata type=\"author\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-date\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'110\']\">\r\n <pz:metadata type=\"corporate-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"corporate-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"corporate-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'111\']\">\r\n <pz:metadata type=\"meeting-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"meeting-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"meeting-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n <pz:metadata type=\"date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'245\']\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'h\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'n\']\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'250\']\">\r\n <pz:metadata type=\"edition\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n        <pz:metadata type=\"publication-place\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'300\']\">\r\n <pz:metadata type=\"physical-extent\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-format\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-dimensions\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-accomp\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'e\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unittype\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unitsize\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-specified\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'3\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'440\']\">\r\n <pz:metadata type=\"series-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag = \'500\' or @tag = \'505\' or\r\n          @tag = \'518\' or @tag = \'520\' or @tag = \'522\']\">\r\n  <pz:metadata type=\"description\">\r\n            <xsl:value-of select=\"*/text()\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n        <pz:metadata type=\"subject\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"subject-long\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text>, </xsl:text>\r\n     </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'856\']\">\r\n <pz:metadata type=\"electronic-url\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'u\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-text\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'y\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-note\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'z\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'773\']\">\r\n        <pz:metadata type=\"citation\">\r\n          <xsl:for-each select=\"*\">\r\n            <xsl:value-of select=\"normalize-space(.)\"/>\r\n            <xsl:text> </xsl:text>\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"marc:subfield[@code=\'t\']\">\r\n          <pz:metadata type=\"journal-title\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'t\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"marc:subfield[@code=\'g\']\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n <xsl:value-of select=\"$medium\"/>\r\n      </pz:metadata>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\">\r\n <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_a\"/>\r\n  </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\">\r\n  <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_b\"/>\r\n  </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'907\' or @tag=\'901\']\">\r\n        <pz:metadata type=\"iii-id\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'926\']\">\r\n        <pz:metadata type=\"holding\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'948\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'991\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:if test=\"$open_url_resolver\">\r\n        <pz:metadata type=\"open-url\">\r\n            <xsl:call-template name=\"insert-md-openurl\" />\r\n        </pz:metadata>\r\n      </xsl:if>\r\n\r\n      <!--passthrough id data-->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n          <xsl:copy-of select=\".\"/>\r\n      </xsl:for-each>\r\n\r\n    </pz:record>    \r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>\r\n','','','','PZ','MARCXML',NULL),(3005,'XmlTransformationStep','<Description>',NULL,'Turbo Marc','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"1.0\"\r\n  xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n  xmlns:tmarc=\"http://www.indexdata.com/turbomarc\">\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\"\r\n    encoding=\"UTF-8\" />\r\n  <xsl:param name=\"medium\"/>\r\n\r\n  <!-- Extract metadata from MARC21/USMARC from streamlined marcxml format \r\n    http://www.loc.gov/marc/bibliographic/ecbdhome.html -->\r\n  <xsl:template name=\"record-hook\" />\r\n\r\n\r\n  <xsl:template match=\"/\">\r\n      <xsl:apply-templates />\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"tmarc:collection\">\r\n    <collection>\r\n      <xsl:apply-templates />\r\n    </collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"tmarc:r\">\r\n    <xsl:variable name=\"title_medium\" select=\"tmarc:d245/tmarc:sh\" />\r\n    <xsl:variable name=\"journal_title\" select=\"tmarc:d773/tmarc:st\" />\r\n    <xsl:variable name=\"electronic_location_url\" select=\"tmarc:d856/tmarc:su\" />\r\n    <xsl:variable name=\"fulltext_a\" select=\"tmarc:d900/tmarc:sa\" />\r\n    <xsl:variable name=\"fulltext_b\" select=\"tmarc:d900/tmarc:sb\" />\r\n    <!-- Does not always hit the right substring. The field is not always fixed-width? -->\r\n    <xsl:variable name=\"control_lang\" select=\"substring(tmarc:c008, 36, 3)\" />\r\n    <xsl:variable name=\"contains110\" select=\"tmarc:d110\" />\r\n    <xsl:variable name=\"hasAuthorFields\" select=\"tmarc:d100 or tmarc:d111\" />\r\n    <xsl:variable name=\"typeofrec\" select=\"substring(tmarc:l, 7, 1)\"/>\r\n    <xsl:variable name=\"typeofvm\" select=\"substring(tmarc:c008, 34, 1)\"/>\r\n    <xsl:variable name=\"biblevel\" select=\"substring(tmarc:l, 8, 1)\"/>\r\n    <xsl:variable name=\"physdes\" select=\"substring(tmarc:c007, 1, 1)\"/>\r\n    <xsl:variable name=\"form1\" select=\"substring(tmarc:c008, 24, 1)\"/>\r\n    <xsl:variable name=\"form2\" select=\"substring(tmarc:c008, 30, 1)\"/>\r\n    <xsl:variable name=\"oclca\" select=\"substring(tmarc:c007, 1, 1)\"/>\r\n    <xsl:variable name=\"oclcb\" select=\"substring(tmarc:c007, 2, 1)\"/>\r\n    <xsl:variable name=\"oclcd\" select=\"substring(tmarc:c007, 4, 1)\"/>\r\n    <xsl:variable name=\"oclce\" select=\"substring(tmarc:c007, 5, 1)\"/>\r\n    <xsl:variable name=\"typeofserial\" select=\"substring(tmarc:c008, 22, 1)\"/>\r\n\r\n    <xsl:variable name=\"electronic\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"$form1=\'s\' or $form1=\'q\' or $form1=\'o\' or\r\n     $form2=\'s\' or $form2=\'q\' or $form2=\'o\'\">\r\n     <xsl:text>yes</xsl:text>\r\n </xsl:when>\r\n <xsl:otherwise/>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"vmedium\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"string-length($medium)\"><xsl:value-of select=\"$medium\" /></xsl:when>\r\n        <xsl:when test=\"($typeofrec=\'a\' or $typeofrec=\'t\') and $biblevel=\'m\'\">book</xsl:when>\r\n        <xsl:when test=\"$typeofrec=\'j\' or $typeofrec=\'i\'\">\r\n    <xsl:text>recording</xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test=\"$oclcb=\'d\' and $oclcd=\'f\'\">-cd</xsl:when>\r\n     <xsl:when test=\"$oclcb=\'s\'\">-cassette</xsl:when>\r\n      <xsl:when test=\"$oclcb=\'d\' and $oclcd=\'a\' or $oclcd=\'b\' or\r\n       $oclcd=\'c\' or $oclcd=\'d\' or $oclcd=\'e\'\">-vinyl</xsl:when>\r\n    </xsl:choose>\r\n </xsl:when>\r\n <xsl:when test=\"$typeofrec=\'g\'\">\r\n    <xsl:choose>\r\n      <xsl:when test=\"$typeofvm=\'m\' or $typeofvm=\'v\'\">\r\n        <xsl:text>video</xsl:text>\r\n        <xsl:choose>\r\n          <xsl:when test=\"$oclca=\'v\' and $oclcb=\'d\' and $oclce=\'v\'\">-dvd</xsl:when>\r\n         <xsl:when test=\"$oclca=\'v\' and $oclcb=\'d\' and $oclce=\'s\'\">-blu-ray</xsl:when>\r\n         <xsl:when test=\"$oclca=\'v\' and $oclcb=\'f\' and $oclce=\'b\'\">-vhs</xsl:when>\r\n       </xsl:choose>\r\n     </xsl:when>\r\n     <xsl:otherwise>audio-visual</xsl:otherwise>\r\n   </xsl:choose>\r\n </xsl:when>\r\n <xsl:when test=\"$typeofrec=\'a\' and $biblevel=\'s\'\">\r\n    <xsl:choose>\r\n      <xsl:when test=\"$typeofserial=\'n\'\">newspaper</xsl:when>\r\n     <xsl:otherwise>journal</xsl:otherwise>\r\n    </xsl:choose>\r\n </xsl:when>\r\n <xsl:when test=\"$typeofrec=\'e\' or $typeofrec=\'f\'\">map</xsl:when>\r\n  <xsl:when test=\"$typeofrec=\'c\' or $typeofrec=\'d\'\">music-score</xsl:when>\r\n  <xsl:when test=\"$form1=\'a\' or $form1=\'b\' or $form1=\'c\'\">microform</xsl:when>\r\n  <xsl:when test=\"$typeofrec=\'t\'\">thesis</xsl:when>\r\n        <!-- <xsl:when test=\"$journal_title\">article</xsl:when> -->\r\n  <xsl:when test=\"$typeofrec=\'a\' or $typeofrec=\'i\' and\r\n     ($typeofserial=\'d\' or $typeofserial=\'w\')\">web</xsl:when>\r\n <xsl:when test=\"$typeofrec=\'a\' and $biblevel=\'b\'\">article</xsl:when>\r\n  <xsl:when test=\"$typeofrec=\'m\'\">electronic</xsl:when>\r\n        <xsl:when test=\"$title_medium\">\r\n          <xsl:value-of select=\"translate($title_medium, \' []/:\', \'\')\" />\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:text>other</xsl:text>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"has_fulltext\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"tmarc:d856/tmarc:sq\">\r\n          <xsl:text>yes</xsl:text>\r\n        </xsl:when>\r\n        <xsl:when test=\"tmarc:d856/tmarc:si=\'TEXT*\'\">\r\n          <xsl:text>yes</xsl:text>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:text>no</xsl:text>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"oclc_number\">\r\n      <xsl:choose>\r\n        <xsl:when test=\'contains(tmarc:c001,\"ocn\") or\r\n                        contains(tmarc:c001,\"ocm\") or\r\n                        contains(tmarc:c001,\"OCoLC\") \'>\r\n         <xsl:value-of select=\"tmarc:c001\"/>\r\n        </xsl:when>\r\n        <xsl:when test=\'contains(tmarc:d035/tmarc:sa,\"ocn\") or\r\n                        contains(tmarc:d035/tmarc:sa,\"ocm\") or\r\n                        contains(tmarc:d035/tmarc:sa,\"OCoLC\") \'>\r\n         <xsl:value-of select=\"tmarc:d035/tmarc:sa\"/>\r\n        </xsl:when>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"date_008\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"contains(\'cestpudikmr\', substring(tmarc:c008, 7, 1))\">\r\n          <xsl:value-of select=\"substring(tmarc:c008, 8, 4)\" />\r\n        </xsl:when>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"date_end_008\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"contains(\'dikmr\', substring(tmarc:c008, 7, 1))\">\r\n          <xsl:value-of select=\"substring(tmarc:c008, 12, 4)\" />\r\n        </xsl:when>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>\r\n<!--\r\n      <xsl:attribute name=\"mergekey\">\r\n    <xsl:text>title </xsl:text>\r\n  <xsl:value-of select=\"tmarc:d245/tmarc:sa\" />\r\n  <xsl:text> author </xsl:text>\r\n  <xsl:value-of select=\"tmarc:d100/tmarc:sa\" />\r\n  <xsl:text> medium </xsl:text>\r\n  <xsl:value-of select=\"$medium\" />\r\n    </xsl:attribute>\r\n  -->\r\n\r\n      <xsl:for-each select=\"tmarc:c001\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"oclc-number\">\r\n        <xsl:value-of select=\"$oclc_number\" />\r\n      </pz:metadata>\r\n\r\n      <xsl:for-each select=\"tmarc:d010\">\r\n        <pz:metadata type=\"lccn\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d020\">\r\n        <pz:metadata type=\"isbn\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d022\">\r\n        <pz:metadata type=\"issn\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d027\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d035\"> \r\n        <pz:metadata type=\"system-control-nr\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sa\">\r\n              <xsl:value-of select=\"tmarc:sa\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>\r\n              <xsl:value-of select=\"tmarc:sb\"/>\r\n            </xsl:otherwise>\r\n          </xsl:choose>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d100\">\r\n        <pz:metadata type=\"author\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"author-title\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"author-date\">\r\n          <xsl:value-of select=\"tmarc:sd\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d110\">\r\n        <pz:metadata type=\"corporate-name\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"corporate-location\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"corporate-date\">\r\n          <xsl:value-of select=\"tmarc:sd\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d111\">\r\n        <pz:metadata type=\"meeting-name\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"meeting-location\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"meeting-date\">\r\n          <xsl:value-of select=\"tmarc:sd\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d260\">\r\n        <pz:metadata type=\"date\">\r\n          <xsl:value-of select=\"translate(tmarc:sc, \'cp[].\', \'\')\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:if test=\"$date_008 and not(tmarc:d260)\">\r\n        <pz:metadata type=\"date\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"$date_end_008\">\r\n              <xsl:value-of select=\"concat($date_008,\'-\',$date_end_008)\" />\r\n            </xsl:when>\r\n            <xsl:otherwise> \r\n              <xsl:value-of select=\"$date_008\" />\r\n            </xsl:otherwise>\r\n          </xsl:choose>\r\n        </pz:metadata>\r\n      </xsl:if>\r\n\r\n\r\n      <xsl:for-each select=\"tmarc:d130\">\r\n        <pz:metadata type=\"title-uniform\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-media\">\r\n          <xsl:value-of select=\"tmarc:sm\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-parts\">\r\n          <xsl:value-of select=\"tmarc:sn\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-partname\">\r\n          <xsl:value-of select=\"tmarc:sp\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-uniform-key\">\r\n          <xsl:value-of select=\"tmarc:sr\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d245\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"tmarc:sb\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"tmarc:sf\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"tmarc:sh\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"tmarc:sn\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-complete\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n          <xsl:if test=\"tmarc:sb\" ><xsl:value-of select=\"concat(\' \', tmarc:sb)\" /></xsl:if>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d250\">\r\n        <pz:metadata type=\"edition\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d260\">\r\n        <pz:metadata type=\"publication-place\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n          <xsl:value-of select=\"tmarc:sb\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d300\">\r\n        <pz:metadata type=\"physical-extent\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-format\">\r\n          <xsl:value-of select=\"tmarc:sb\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-dimensions\">\r\n          <xsl:value-of select=\"tmarc:sc\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-accomp\">\r\n          <xsl:value-of select=\"tmarc:se\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-unittype\">\r\n          <xsl:value-of select=\"tmarc:sf\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-unitsize\">\r\n          <xsl:value-of select=\"tmarc:sg\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"physical-specified\">\r\n          <xsl:value-of select=\"tmarc:s3\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d440\">\r\n        <pz:metadata type=\"series-title\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d500\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d505\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d518\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d520\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d522\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d911\">\r\n        <pz:metadata type=\"description\">\r\n          <xsl:for-each select=\"node()\">\r\n            <xsl:value-of select=\"text()\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d600\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d610\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d611\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d630\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d648\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d650\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d651\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d653\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d654\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d655\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d656\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d657\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d658\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d662\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d69X\">\r\n        <pz:metadata type=\"subject\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"subject-long\">\r\n          <xsl:for-each select=\"node()/text()\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text>, </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- or tmarc:d651 or tmarc:d653 or tmarc:d654 or tmarc:d655 or tmarc:d656 \r\n        or tmarc:d657 or tmarc:d658 or tmarc:d662 or tmarc:d69X\"> -->\r\n\r\n      <!-- <xsl:for-each select=\"tmarc:d600\" > <pz:metadata type=\"subject\"> \r\n        <xsl:value-of select=\"tmarc:sa\"/> </pz:metadata> <pz:metadata type=\"subject-long\"> \r\n        <xsl:for-each select=\"tmarc:sa tmarc:sb tmarc:sc tmarc:sd \"> <xsl:if test=\"position() \r\n        > 1\"> <xsl:text>, </xsl:text> </xsl:if> <xsl:value-of select=\".\"/> </xsl:for-each> \r\n        </pz:metadata> </xsl:for-each> -->\r\n\r\n      <xsl:for-each select=\"tmarc:d856\">\r\n        <pz:metadata type=\"electronic-url\">\r\n          <xsl:value-of select=\"tmarc:su\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-text\">\r\n          <xsl:choose>\r\n     <xsl:when test=\"tmarc:sy\">\r\n        <xsl:value-of select=\"tmarc:sy/text()\" />\r\n     </xsl:when>\r\n     <xsl:when test=\"tmarc:s3\">\r\n        <xsl:value-of select=\"tmarc:s3/text()\" />\r\n     </xsl:when>\r\n      <xsl:otherwise>Get resource</xsl:otherwise>\r\n     </xsl:choose>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-note\">\r\n          <xsl:value-of select=\"tmarc:sz\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-format-instruction\">\r\n          <xsl:value-of select=\"tmarc:si\" />\r\n        </pz:metadata>\r\n        <pz:metadata type=\"electronic-format-type\">\r\n          <xsl:value-of select=\"tmarc:sq\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d773\">\r\n        <pz:metadata type=\"citation\">\r\n          <xsl:for-each select=\"*\">\r\n            <xsl:value-of select=\"normalize-space(.)\" />\r\n            <xsl:text> </xsl:text>\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"tmarc:st\">\r\n          <pz:metadata type=\"journal-title\">\r\n            <xsl:value-of select=\"tmarc:st\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"tmarc:sg\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"tmarc:sg\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"tmarc:sp\">\r\n          <pz:metadata type=\"journal-title-abbrev\">\r\n            <xsl:value-of select=\"tmarc:sp\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d852\">\r\n        <xsl:if test=\"tmarc:sy\">\r\n          <pz:metadata type=\"publicnote\">\r\n            <xsl:value-of select=\"tmarc:sy\" />\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"tmarc:sh\">\r\n          <pz:metadata type=\"callnumber\">\r\n            <xsl:value-of select=\"tmarc:sh\" />\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d876\">\r\n        <xsl:if test=\"tmarc:sf\">\r\n          <pz:metadata type=\"loan-period\">\r\n            <xsl:value-of select=\"tmarc:sf\" />\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n        <xsl:value-of select=\"$vmedium\" />\r\n <xsl:if test=\"string-length($electronic) and $vmedium != \'electronic\'\">\r\n   <xsl:text> (electronic)</xsl:text>\r\n  </xsl:if>\r\n      </pz:metadata>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sa\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\"> <pz:metadata type=\"fulltext\"> <xsl:value-of \r\n        select=\"$fulltext_a\"/> </pz:metadata> </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sb\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:se\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sf\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:si\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sk\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sq\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:ss\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:su\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d900/tmarc:sy\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\"> <pz:metadata type=\"fulltext\"> <xsl:value-of \r\n        select=\"$fulltext_b\"/> </pz:metadata> </xsl:if> -->\r\n\r\n      <pz:metadata type=\"has-fulltext\">\r\n        <xsl:value-of select=\"$has_fulltext\"/>\r\n      </pz:metadata>\r\n\r\n      <xsl:for-each select=\"tmarc:d907 | tmarc:d901\">\r\n        <pz:metadata type=\"iii-id\">\r\n          <xsl:value-of select=\"tmarc:sa\" />\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d926\">\r\n        <pz:metadata type=\"locallocation\">\r\n   <xsl:choose><xsl:when test=\"tmarc:sa\">\r\n      <xsl:value-of select=\"tmarc:sa\"/>\r\n   </xsl:when><xsl:otherwise>\r\n      <xsl:text>PAZPAR2_NULL_VALUE</xsl:text>\r\n   </xsl:otherwise></xsl:choose>\r\n </pz:metadata>\r\n        <pz:metadata type=\"callnumber\">\r\n   <xsl:choose><xsl:when test=\"tmarc:sc\">\r\n      <xsl:value-of select=\"tmarc:sc\"/>\r\n   </xsl:when><xsl:otherwise>\r\n      <xsl:text>PAZPAR2_NULL_VALUE</xsl:text>\r\n   </xsl:otherwise></xsl:choose>\r\n </pz:metadata>\r\n        <pz:metadata type=\"available\">\r\n    <xsl:choose><xsl:when test=\"tmarc:se\">\r\n      <xsl:value-of select=\"tmarc:se\"/>\r\n   </xsl:when><xsl:otherwise>\r\n      <xsl:text>PAZPAR2_NULL_VALUE</xsl:text>\r\n   </xsl:otherwise></xsl:choose>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- OhioLINK holdings -->\r\n      <xsl:for-each select=\"tmarc:d945\">\r\n <pz:metadata type=\"locallocation\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sa\">\r\n              <xsl:value-of select=\"tmarc:sa\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n  </pz:metadata>\r\n  <pz:metadata type=\"callnumber\">\r\n          <xsl:choose>\r\n     <xsl:when test=\"tmarc:sb\">\r\n              <xsl:value-of select=\"tmarc:sb\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n  </pz:metadata>\r\n  <pz:metadata type=\"publicnote\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sc\">\r\n              <xsl:value-of select=\"tmarc:sc\"/>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n </pz:metadata>\r\n  <pz:metadata type=\"available\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:ss = \'N\'\">Available</xsl:when>\r\n            <xsl:when test=\"tmarc:ss != \'N\'\">\r\n              <xsl:choose>\r\n   <xsl:when test=\"tmarc:sd\">\r\n                  <xsl:value-of select=\"tmarc:sd\"/>\r\n   </xsl:when>\r\n   <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n              </xsl:choose>\r\n            </xsl:when>\r\n            <xsl:otherwise>PAZPAR2_NULL_VALUE</xsl:otherwise>\r\n          </xsl:choose>\r\n </pz:metadata>      \r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d948\">\r\n        <pz:metadata type=\"holding\">\r\n          <xsl:for-each select=\"tmarc:s\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text> </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d991\">\r\n        <pz:metadata type=\"holding\">\r\n          <xsl:for-each select=\"tmarc:s\">\r\n            <xsl:if test=\"position() > 1\">\r\n              <xsl:text> </xsl:text>\r\n            </xsl:if>\r\n            <xsl:value-of select=\".\" />\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"tmarc:d999\">\r\n        <pz:metadata type=\"localid\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"tmarc:sa\">\r\n              <xsl:value-of select=\"tmarc:sa\"/>\r\n            </xsl:when>\r\n            <xsl:when test=\"tmarc:sc\">\r\n              <xsl:value-of select=\"tmarc:sc\"/>\r\n            </xsl:when> \r\n            <xsl:otherwise>\r\n              <xsl:value-of select=\"tmarc:sd\"/>\r\n            </xsl:otherwise>\r\n          </xsl:choose>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n\r\n      <!-- passthrough id data -->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n        <xsl:copy-of select=\".\" />\r\n      </xsl:for-each>\r\n\r\n      <!-- other stylesheets importing this might want to define this -->\r\n <xsl:call-template name=\"record-hook\" />\r\n\r\n    </pz:record>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"text()\" />\r\n\r\n  <!-- TODO Does not work anymore -->\r\n  <xsl:template name=\"shortTitle\">\r\n    <xsl:param name=\"tag\" />\r\n    <xsl:for-each select=\"tmarc:d\">\r\n      <xsl:value-of select=\"tmarc:sa\" />\r\n      <xsl:value-of select=\"tmarc:sm\" />\r\n      <xsl:value-of select=\"tmarc:sn\" />\r\n      <xsl:value-of select=\"tmarc:sp\" />\r\n      <xsl:value-of select=\"tmarc:sr\" />\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n\r\n  <!-- No working as expected -->\r\n  <xsl:template name=\"description\">\r\n    <xsl:param name=\"element\" />\r\n    <xsl:for-each select=\"$element\">\r\n      <pz:metadata type=\"description\">\r\n        <xsl:for-each select=\"node()\">\r\n          <xsl:value-of select=\"text()\" />\r\n        </xsl:for-each>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n    <xsl:apply-templates />\r\n  </xsl:template>\r\n\r\n  <!-- <xsl:for-each select=\"tmarc:d500\"> <pz:metadata type=\"description\"> \r\n    <xsl:for-each select=\"node()\"> <xsl:value-of select=\"text()\"/> </xsl:for-each> \r\n    </pz:metadata> </xsl:for-each> -->\r\n\r\n  <xsl:template name=\"subject\">\r\n    <xsl:param name=\"element\" />\r\n    <xsl:for-each select=\"$element\">\r\n      <pz:metadata type=\"subject\">\r\n        <xsl:value-of select=\"tmarc:sa\" />\r\n      </pz:metadata>\r\n      <pz:metadata type=\"subject-long\">\r\n        <xsl:for-each select=\"node()/text()\">\r\n          <xsl:if test=\"position() > 1\">\r\n            <xsl:text>, </xsl:text>\r\n          </xsl:if>\r\n          <xsl:value-of select=\".\" />\r\n        </xsl:for-each>\r\n      </pz:metadata>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n</xsl:stylesheet>\r\n','','','','PZ','TXML',NULL),(3153,'XmlTransformationStep','Convert GPDC to MARC21',NULL,'GPDC to MARC21','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"1.0\" \r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\" \r\n    xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns=\"http://www.loc.gov/MARC21/slim\" \r\n   xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" exclude-result-prefixes=\"dc\" \r\n    xmlns:pgterms=\"http://www.gutenberg.org/rdfterms/\">\r\n    <xsl:output method=\"xml\" indent=\"yes\"/>\r\n    <xsl:strip-space elements=\"pgterms:file\"/>\r\n    <xsl:template match=\"/\">\r\n      <collection>\r\n  <xsl:apply-templates />\r\n      </collection>\r\n    </xsl:template>\r\n    <xsl:template match=\"rdf:Description\">\r\n      <xsl:comment>\r\n  <xsl:value-of select=\".\" />\r\n      </xsl:comment>\r\n    </xsl:template>\r\n    <xsl:template match=\"pgterms:etext\">\r\n        <record>\r\n            <xsl:element name=\"leader\">\r\n                <xsl:variable name=\"type\" select=\"dc:type\"/>\r\n                <xsl:variable name=\"leader06\">\r\n                    <xsl:choose>\r\n                        <xsl:when test=\"$type=\'collection\'\">p</xsl:when>\r\n                        <xsl:when test=\"$type=\'dataset\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'event\'\">r</xsl:when>\r\n                        <xsl:when test=\"$type=\'image\'\">k</xsl:when>\r\n                        <xsl:when test=\"$type=\'interactive resource\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'service\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'software\'\">m</xsl:when>\r\n                        <xsl:when test=\"$type=\'sound\'\">i</xsl:when>\r\n                        <xsl:when test=\"$type=\'text\'\">a</xsl:when>\r\n                        <xsl:otherwise>a</xsl:otherwise>\r\n                    </xsl:choose>\r\n                </xsl:variable>\r\n                <xsl:variable name=\"leader07\">\r\n                    <xsl:choose>\r\n                        <xsl:when test=\"$type=\'collection\'\">c</xsl:when>\r\n                        <xsl:otherwise>m</xsl:otherwise>\r\n                    </xsl:choose>\r\n                </xsl:variable>\r\n                <xsl:value-of select=\"concat(\'      \',$leader06,$leader07,\'         3u     \')\"/>\r\n            </xsl:element>\r\n      <controlfield tag=\"001\">\r\n        <xsl:value-of select=\"substring(@rdf:ID, 6)\"/>\r\n      </controlfield>\r\n     <datafield tag=\"856\" ind1=\"0\" ind2=\"0\">\r\n       <subfield code=\"u\">http://www.gutenberg.org/ebooks/<xsl:value-of select=\"substring(@rdf:ID, 6)\"/></subfield>\r\n      </datafield>\r\n\r\n            <xsl:for-each select=\"dc:contributer\">\r\n                <datafield tag=\"720\" ind1=\"0\" ind2=\"0\">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                    <subfield code=\"e\">collaborator</subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:coverage\">\r\n                <datafield tag=\"500\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:creator\">\r\n                <datafield tag=\"100\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n<!--\r\n                    <subfield code=\"e\">author</subfield>\r\n-->\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:date\">\r\n                <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"c\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>    \r\n\r\n            <xsl:for-each select=\"dc:description\">\r\n                <datafield tag=\"520\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:identifier\">\r\n                <datafield tag=\"856\" ind1=\"4\" ind2=\"0\">\r\n                    <subfield code=\"u\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n       <xsl:if test=\"dc:format\">\r\n         <subfield code=\"q\">\r\n           <xsl:value-of select=\"dc:format\"/>\r\n          </subfield>\r\n       </xsl:if>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:language\">\r\n                <datafield tag=\"546\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:publisher\">\r\n                <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"b\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:relation\">\r\n                <datafield tag=\"787\" ind1=\"0\" ind2=\" \">\r\n                    <subfield code=\"n\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:rights\">\r\n                <datafield tag=\"540\" ind1=\" \" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:source\">\r\n                <datafield tag=\"786\" ind1=\"0\" ind2=\" \">\r\n                    <subfield code=\"n\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <datafield tag=\"650\" ind1=\" \" ind2=\" \">\r\n       <xsl:for-each select=\"dc:subject\">\r\n<!--        <xsl:for-each select=\"tokenize(.,\';|- -\')\"> -->\r\n         <subfield code=\"a\"><xsl:value-of select=\"normalize-space(.)\" /></subfield>\r\n<!--        </xsl:for-each> -->\r\n              </xsl:for-each>\r\n      </datafield>\r\n\r\n            <xsl:for-each select=\"dc:title[1]\">\r\n                <datafield tag=\"245\" ind1=\"0\" ind2=\"0\">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:title[position()>1]\">\r\n                <datafield tag=\"246\" ind1=\"3\" ind2=\"3\"><subfield code=\"a\"><xsl:value-of select=\".\"/></subfield></datafield>\r\n            </xsl:for-each>\r\n\r\n            <xsl:for-each select=\"dc:type\">\r\n                <datafield tag=\"655\" ind1=\"7\" ind2=\" \">\r\n                    <subfield code=\"a\">\r\n                        <xsl:value-of select=\".\"/>\r\n                    </subfield>\r\n                    <subfield code=\"2\">local</subfield>\r\n                </datafield>\r\n            </xsl:for-each>\r\n        </record>\r\n    </xsl:template>\r\n  <!-- Ignore other elements by mapping into empty DOM XML trees -->\r\n<!--\r\n  <xsl:template match=\"/*\"/>\r\n-->\r\n  <xsl:template match=\"pgterms:file\" />\r\n\r\n</xsl:stylesheet>\r\n','','','','MARCXML','GPDC',NULL),(3155,'XmlTransformationStep','Convert DC to MARC21',NULL,'DC to MARC21 (slim)','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns=\"http://www.loc.gov/MARC21/slim\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" exclude-result-prefixes=\"dc\">\r\n  <xsl:output method=\"xml\" indent=\"yes\"/>\r\n \r\n  <xsl:template match=\"/\">\r\n    <record xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd\" >\r\n      <xsl:element name=\"leader\">\r\n       <xsl:variable name=\"type\" select=\"dc:type\"/>\r\n        <xsl:variable name=\"leader06\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"$type=\'collection\'\">p</xsl:when>\r\n            <xsl:when test=\"$type=\'dataset\'\">m</xsl:when>\r\n           <xsl:when test=\"$type=\'event\'\">r</xsl:when>\r\n           <xsl:when test=\"$type=\'image\'\">k</xsl:when>\r\n           <xsl:when test=\"$type=\'interactive resource\'\">m</xsl:when>\r\n            <xsl:when test=\"$type=\'service\'\">m</xsl:when>\r\n           <xsl:when test=\"$type=\'software\'\">m</xsl:when>\r\n            <xsl:when test=\"$type=\'sound\'\">i</xsl:when>\r\n           <xsl:when test=\"$type=\'text\'\">a</xsl:when>\r\n            <xsl:otherwise>a</xsl:otherwise>\r\n          </xsl:choose>\r\n       </xsl:variable>\r\n       <xsl:variable name=\"leader07\">\r\n          <xsl:choose>\r\n            <xsl:when test=\"$type=\'collection\'\">c</xsl:when>\r\n            <xsl:otherwise>m</xsl:otherwise>\r\n          </xsl:choose>\r\n       </xsl:variable>\r\n       <xsl:value-of select=\"concat(\'      \',$leader06,$leader07,\'         3u     \')\"/>\r\n      </xsl:element>\r\n\r\n      <datafield tag=\"042\" ind1=\" \" ind2=\" \">\r\n       <subfield code=\"a\">dc</subfield>\r\n      </datafield>\r\n\r\n      <xsl:for-each select=\"//dc:contributer\">\r\n        <datafield tag=\"720\" ind1=\"0\" ind2=\"0\">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n         <subfield code=\"e\">collaborator</subfield>\r\n        </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:coverage\">\r\n       <datafield tag=\"500\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:creator\">\r\n        <datafield tag=\"720\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n         <subfield code=\"e\">author</subfield>\r\n        </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:date\">\r\n       <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"c\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each> \r\n\r\n      <xsl:for-each select=\"//dc:description\">\r\n        <datafield tag=\"520\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n     \r\n      <xsl:for-each select=\"//dc:format\">\r\n       <datafield tag=\"856\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"q\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:identifier\">\r\n       <datafield tag=\"024\" ind1=\"8\" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:language\">\r\n       <datafield tag=\"546\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n     \r\n      <xsl:for-each select=\"//dc:publisher\">\r\n        <datafield tag=\"260\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"b\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:relation\">\r\n       <datafield tag=\"787\" ind1=\"0\" ind2=\" \">\r\n         <subfield code=\"n\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:rights\">\r\n       <datafield tag=\"540\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:source\">\r\n       <datafield tag=\"786\" ind1=\"0\" ind2=\" \">\r\n         <subfield code=\"n\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:subject\">\r\n        <datafield tag=\"653\" ind1=\" \" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n                                             \r\n      <xsl:for-each select=\"//dc:title[1]\">\r\n       <datafield tag=\"245\" ind1=\"0\" ind2=\"0\">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:title[position()>1]\">\r\n        <datafield tag=\"246\" ind1=\"3\" ind2=\"3\">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n\r\n     <xsl:for-each select=\"//dc:type\">\r\n       <datafield tag=\"655\" ind1=\"7\" ind2=\" \">\r\n         <subfield code=\"a\">\r\n           <xsl:value-of select=\".\"/>\r\n          </subfield>\r\n         <subfield code=\"2\">local</subfield>\r\n       </datafield>\r\n      </xsl:for-each>\r\n   </record>\r\n </xsl:template>\r\n</xsl:stylesheet>','','','','MARCXML','DC',NULL),(3653,'XmlTransformationStep','<Description>',NULL,'Wiki Abstract 2 PZ','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n                xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\" version=\"1.0\" >\r\n    \r\n  <xsl:output method=\"xml\" indent=\"yes\" />\r\n  <xsl:template match=\"/\">\r\n    <collection>\r\n      <xsl:apply-templates />\r\n      </collection>\r\n    </xsl:template>\r\n    <xsl:template match=\"feed\">\r\n            <xsl:apply-templates />\r\n    </xsl:template>\r\n    <xsl:template match=\"doc\">\r\n      <pz:record>\r\n <pz:metadata type=\"id\">\r\n   <xsl:value-of select=\"substring-after(url,\'http://\')\" />\r\n    </pz:metadata>\r\n  <pz:metadata type=\"title\">\r\n    <xsl:value-of select=\"substring-after(title, \'Wikipedia: \')\" />\r\n   </pz:metadata>\r\n  <!-- <field name=\"title-abbreviated\"> <xsl:value-of select=\"substring-before(substring-after(concat(title, \r\n       \' (\'), \'Wikipedia: \'), \' (\')\"/> </field> -->\r\n  <!-- <field name=\"date\"> <xsl:value-of select=\"date\" /> </field> -->\r\n  <pz:metadata type=\"description\">\r\n    <xsl:value-of select=\"abstract\" />\r\n    </pz:metadata>\r\n  <pz:metadata type=\"electronic-url\">\r\n   <xsl:value-of select=\"url\" />\r\n   </pz:metadata>\r\n  </pz:record>\r\n      </xsl:template>\r\n</xsl:stylesheet>\r\n','','','','PZ','WIKI',NULL),(4053,'XmlTransformationStep','Without include. Does not work',NULL,'Marc21 to PZ (full)','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\"\r\n    xmlns:str=\"http://exslt.org/strings\"\r\n    extension-element-prefixes=\"str\">\r\n\r\n  <xsl:param name=\"open_url_resolver\"/>\r\n  <!--<xsl:variable name=\"resolver\">http://zeus.lib.uoc.gr:3210/sfxtst3</xsl:variable>-->\r\n \r\n  <xsl:template name=\"insert-md-openurl\">\r\n  \r\n    <xsl:value-of select=\"$open_url_resolver\" /><xsl:text>?generatedby=pz2</xsl:text>\r\n    <xsl:call-template name=\"ou-parse-author\" />\r\n    <xsl:call-template name=\"ou-parse-date\" />\r\n    <xsl:call-template name=\"ou-parse-volume\" />\r\n    <xsl:call-template name=\"ou-parse-any\">\r\n      <xsl:with-param name=\"field_name\" select=\"string(\'isbn\')\" />\r\n    </xsl:call-template>\r\n    <xsl:call-template name=\"ou-parse-any\">\r\n      <xsl:with-param name=\"field_name\" select=\"string(\'issn\')\" />\r\n    </xsl:call-template>\r\n    <xsl:call-template name=\"ou-parse-any\">\r\n      <xsl:with-param name=\"field_name\" select=\"string(\'title\')\" />\r\n    </xsl:call-template>\r\n    <xsl:call-template name=\"ou-parse-any\">\r\n      <xsl:with-param name=\"field_name\" select=\"string(\'atitle\')\" />\r\n    </xsl:call-template>\r\n\r\n  </xsl:template>\r\n \r\n  <!-- parsing raw string data -->\r\n  \r\n  <xsl:template name=\"ou-parse-author\" >\r\n    <xsl:variable name=\"author\">\r\n      <xsl:call-template name=\"ou-author\" />\r\n    </xsl:variable>\r\n    \r\n    <xsl:variable name=\"aulast\" select=\"normalize-space(substring-before($author, \',\'))\"/>\r\n\r\n    <xsl:variable name=\"aufirst\" \r\n      select=\"substring-before( normalize-space(substring-after($author, \',\')), \' \')\"/>\r\n\r\n    <xsl:if test=\"$aulast != \'\'\">\r\n      <xsl:text>&amp;aulast=</xsl:text>\r\n      <xsl:value-of select=\"$aulast\" />\r\n    </xsl:if>\r\n\r\n    <xsl:if test=\"string-length( translate($aufirst, \'.\', \'\') ) &gt; 1\" >\r\n      <xsl:text>&amp;aufirst=</xsl:text>\r\n      <xsl:value-of select=\"$aufirst\" />\r\n    </xsl:if>\r\n\r\n  </xsl:template>\r\n\r\n  <xsl:template name=\"ou-parse-volume\">\r\n    <xsl:variable name=\"volume\">\r\n      <xsl:call-template name=\"ou-volume\" />\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"vol\" select=\"substring-after($volume, \'Vol\')\"/>\r\n    <xsl:variable name=\"issue\" select=\"false()\" />\r\n    <xsl:variable name=\"spage\" select=\"false()\" />\r\n\r\n    <xsl:if test=\"$vol\">\r\n      <xsl:text>&amp;volume=</xsl:text>\r\n      <xsl:value-of select=\"$vol\" />\r\n    </xsl:if>\r\n\r\n    <xsl:if test=\"$issue\">\r\n      <xsl:text>&amp;issue=</xsl:text>\r\n      <xsl:value-of select=\"$issue\" />\r\n    </xsl:if>\r\n    \r\n    <xsl:if test=\"$spage\">\r\n      <xsl:text>&amp;spage=</xsl:text>\r\n      <xsl:value-of select=\"$vol\" />\r\n    </xsl:if>\r\n\r\n  </xsl:template>\r\n\r\n\r\n  <xsl:template name=\"ou-parse-date\">\r\n    <xsl:variable name=\"date\">\r\n      <xsl:call-template name=\"ou-date\" />\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"parsed_date\" select=\"translate($date, \'.[]c;\', \'\')\"/>\r\n\r\n    <xsl:if test=\"$parsed_date\">\r\n      <xsl:text>&amp;date=</xsl:text>\r\n      <xsl:value-of select=\"$parsed_date\" />\r\n    </xsl:if>\r\n\r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template name=\"ou-parse-any\">\r\n    <xsl:param name=\"field_name\" />\r\n\r\n    <xsl:variable name=\"field_value\">\r\n      <xsl:choose>\r\n\r\n      <xsl:when test=\"$field_name = \'isbn\'\">\r\n        <xsl:call-template name=\"ou-isbn\"/>\r\n      </xsl:when>\r\n\r\n      <xsl:when test=\"$field_name = \'issn\'\">\r\n        <xsl:call-template name=\"ou-issn\"/>\r\n      </xsl:when>\r\n      \r\n      <xsl:when test=\"$field_name = \'atitle\'\">\r\n        <xsl:call-template name=\"ou-atitle\"/>\r\n      </xsl:when>\r\n     \r\n      <xsl:when test=\"$field_name = \'title\'\">\r\n        <xsl:call-template name=\"ou-title\"/>\r\n      </xsl:when>\r\n\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:variable name=\"digits\" select=\"1234567890\"/>\r\n\r\n    <xsl:variable name=\"parsed_value\">\r\n      <xsl:choose>\r\n\r\n      <xsl:when test=\"$field_name = \'isbn\'\">\r\n        <xsl:value-of select=\"translate($field_value, translate($field_value, concat($digits, \'X\'), \'\'), \'\')\"/>\r\n      </xsl:when>\r\n\r\n      <xsl:when test=\"$field_name = \'issn\'\">\r\n        <xsl:value-of select=\"translate($field_value, translate($field_value, concat($digits, \'-\', \'X\'), \'\'), \'\')\"/>\r\n      </xsl:when>\r\n      \r\n      <xsl:when test=\"$field_name = \'atitle\'\">\r\n        <xsl:value-of select=\"translate(normalize-space($field_value), \'.\', \'\')\"/>\r\n      </xsl:when>\r\n     \r\n      <xsl:when test=\"$field_name = \'title\'\">\r\n        <xsl:value-of select=\"translate(normalize-space($field_value), \'.\', \'\')\"/>\r\n      </xsl:when>\r\n\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n\r\n    <xsl:if test=\"$parsed_value != \'\'\">\r\n      <xsl:text>&amp;</xsl:text>\r\n      <xsl:value-of select=\"$field_name\" />\r\n      <xsl:text>=</xsl:text>\r\n      <xsl:value-of select=\"$parsed_value\" />\r\n    </xsl:if>\r\n\r\n  </xsl:template>\r\n\r\n\r\n<xsl:template name=\"ou-author\" >\r\n  <!-- what to do with multiple authors??-->\r\n    <xsl:for-each select=\"marc:datafield[@tag=\'100\' or @tag=\'700\']\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n\r\n  <xsl:template name=\"ou-title\" >\r\n  <!-- if 773 exists its a journal/article -->\r\n    <xsl:choose>\r\n    \r\n      <xsl:when test=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\">\r\n        <xsl:value-of select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\"/>\r\n      </xsl:when>\r\n\r\n      <xsl:when test=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'a\']\">\r\n        <xsl:value-of select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'a\']\"/>\r\n      </xsl:when>\r\n\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template name=\"ou-atitle\" >\r\n    <!-- return value only if article or journal -->\r\n    <xsl:if test=\"marc:datafield[@tag=\'773\']\">\r\n      <xsl:value-of select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'a\']\"/>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n\r\n  <xsl:template name=\"ou-date\" >\r\n    <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template name=\"ou-isbn\" >\r\n  <!-- if 773 exists its a journal/article -->\r\n    <xsl:choose>  \r\n    \r\n      <xsl:when test=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'z\']\">\r\n        <xsl:value-of select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'z\']\"/>\r\n      </xsl:when>\r\n      \r\n      <xsl:when test=\"marc:datafield[@tag=\'020\']/marc:subfield[@code=\'a\']\">\r\n        <xsl:value-of select=\"marc:datafield[@tag=\'020\']/marc:subfield[@code=\'a\']\"/>\r\n      </xsl:when>\r\n\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template name=\"ou-issn\" >\r\n  <!-- if 773 exists its a journal/article -->\r\n    <xsl:choose>\r\n    \r\n      <xsl:when test=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'x\']\">\r\n        <xsl:value-of select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'x\']\"/>\r\n      </xsl:when>\r\n\r\n      <xsl:when test=\"marc:datafield[@tag=\'022\']/marc:subfield[@code=\'a\']\">\r\n        <xsl:value-of select=\"marc:datafield[@tag=\'022\']/marc:subfield[@code=\'a\']\"/>\r\n      </xsl:when>\r\n\r\n      </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"/\">\r\n    <pz:collection> \r\n      <xsl:apply-templates />\r\n    </pz:collection>\r\n  </xsl:template>           \r\n  \r\n  <xsl:template match=\"//delete\">\r\n  <xsl:copy-of select=\".\"/>                                                                                                                                                                               \r\n  </xsl:template>            \r\n  \r\n  <xsl:template match=\"//marc:record\">\r\n    <xsl:variable name=\"title_medium\" select=\"marc:datafield[@tag=\'245\']/marc:subfield[@code=\'h\']\"/>\r\n    <xsl:variable name=\"journal_title\" select=\"marc:datafield[@tag=\'773\']/marc:subfield[@code=\'t\']\"/>\r\n    <xsl:variable name=\"electronic_location_url\" select=\"marc:datafield[@tag=\'856\']/marc:subfield[@code=\'u\']\"/>\r\n    <xsl:variable name=\"fulltext_a\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\"/>\r\n    <xsl:variable name=\"fulltext_b\" select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\"/>\r\n    <xsl:variable name=\"medium\">\r\n      <xsl:choose>\r\n <xsl:when test=\"$title_medium\">\r\n   <xsl:value-of select=\"substring-after(substring-before($title_medium,\']\'),\'[\')\"/>\r\n </xsl:when>\r\n <xsl:when test=\"$fulltext_a\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$fulltext_b\">\r\n   <xsl:text>electronic resource</xsl:text>\r\n  </xsl:when>\r\n <xsl:when test=\"$journal_title\">\r\n    <xsl:text>article</xsl:text>\r\n  </xsl:when>\r\n <xsl:otherwise>\r\n   <xsl:text>book</xsl:text>\r\n </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <pz:record>      \r\n      <xsl:for-each select=\"marc:controlfield[@tag=\'001\']\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'010\']\">\r\n        <pz:metadata type=\"lccn\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'020\']\">\r\n        <pz:metadata type=\"isbn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'022\']\">\r\n        <pz:metadata type=\"issn\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'027\']\">\r\n        <pz:metadata type=\"tech-rep-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'035\']\">\r\n        <pz:metadata type=\"system-control-nr\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'100\']\">\r\n <pz:metadata type=\"author\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"author-date\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'110\']\">\r\n <pz:metadata type=\"corporate-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"corporate-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"corporate-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'111\']\">\r\n <pz:metadata type=\"meeting-name\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"meeting-location\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"meeting-date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'d\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n <pz:metadata type=\"date\">\r\n     <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'245\']\">\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-remainder\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-responsibility\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-dates\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-medium\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'h\']\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"title-number-section\">\r\n          <xsl:value-of select=\"marc:subfield[@code=\'n\']\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'250\']\">\r\n <pz:metadata type=\"edition\">\r\n      <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n        <pz:metadata type=\"publication-place\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-name\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n        <pz:metadata type=\"publication-date\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'300\']\">\r\n <pz:metadata type=\"physical-extent\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-format\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-dimensions\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-accomp\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'e\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unittype\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'f\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-unitsize\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"physical-specified\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'3\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'440\']\">\r\n <pz:metadata type=\"series-title\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag = \'500\' or @tag = \'505\' or\r\n          @tag = \'518\' or @tag = \'520\' or @tag = \'522\']\">\r\n  <pz:metadata type=\"description\">\r\n            <xsl:value-of select=\"*/text()\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n        <pz:metadata type=\"subject\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"subject-long\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text>, </xsl:text>\r\n     </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'856\']\">\r\n <pz:metadata type=\"electronic-url\">\r\n   <xsl:value-of select=\"marc:subfield[@code=\'u\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-text\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'y\']\"/>\r\n </pz:metadata>\r\n  <pz:metadata type=\"electronic-note\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'z\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'773\']\">\r\n        <pz:metadata type=\"citation\">\r\n          <xsl:for-each select=\"*\">\r\n            <xsl:value-of select=\"normalize-space(.)\"/>\r\n            <xsl:text> </xsl:text>\r\n          </xsl:for-each>\r\n        </pz:metadata>\r\n        <xsl:if test=\"marc:subfield[@code=\'t\']\">\r\n          <pz:metadata type=\"journal-title\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'t\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"marc:subfield[@code=\'g\']\">\r\n          <pz:metadata type=\"journal-subpart\">\r\n            <xsl:value-of select=\"marc:subfield[@code=\'g\']\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n      </xsl:for-each>\r\n\r\n      <pz:metadata type=\"medium\">\r\n <xsl:value-of select=\"$medium\"/>\r\n      </pz:metadata>\r\n      \r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'a\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_a\">\r\n <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_a\"/>\r\n  </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'900\']/marc:subfield[@code=\'b\']\">\r\n        <pz:metadata type=\"fulltext\">\r\n          <xsl:value-of select=\".\"/>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <!-- <xsl:if test=\"$fulltext_b\">\r\n  <pz:metadata type=\"fulltext\">\r\n   <xsl:value-of select=\"$fulltext_b\"/>\r\n  </pz:metadata>\r\n      </xsl:if> -->\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'907\' or @tag=\'901\']\">\r\n        <pz:metadata type=\"iii-id\">\r\n    <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'926\']\">\r\n        <pz:metadata type=\"holding\">\r\n   <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'948\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'991\']\">\r\n        <pz:metadata type=\"holding\">\r\n    <xsl:for-each select=\"marc:subfield\">\r\n     <xsl:if test=\"position() > 1\">\r\n        <xsl:text> </xsl:text>\r\n      </xsl:if>\r\n     <xsl:value-of select=\".\"/>\r\n    </xsl:for-each>\r\n        </pz:metadata>\r\n      </xsl:for-each>\r\n\r\n      <xsl:if test=\"$open_url_resolver\">\r\n        <pz:metadata type=\"open-url\">\r\n            <xsl:call-template name=\"insert-md-openurl\" />\r\n        </pz:metadata>\r\n      </xsl:if>\r\n\r\n      <!--passthrough id data-->\r\n      <xsl:for-each select=\"pz:metadata\">\r\n          <xsl:copy-of select=\".\"/>\r\n      </xsl:for-each>\r\n\r\n    </pz:record>    \r\n  </xsl:template>\r\n\r\n  \r\n  <xsl:template match=\"text()\"/>\r\n\r\n</xsl:stylesheet>\r\n','','','','PZ','MARCXML',NULL),(4055,'XmlTransformationStep','Medium cleanup',NULL,'Medium Normalization (PZ)','<?xml version=\"1.0\"?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\" \r\n    xmlns:tmarc=\"http://www.indexdata.com/turbomarc\">\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\" />\r\n  <xsl:template  match=\"/\">\r\n    <pz:collection>\r\n      <xsl:apply-templates/>\r\n    </pz:collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:record\">\r\n    <pz:record>\r\n      <xsl:apply-templates/>\r\n    </pz:record>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'medium\']\">\r\n    <pz:metadata type=\'medium\'>\r\n      <xsl:choose>\r\n        <xsl:when \r\n     test=\". = \'article\' or . = \'audio-visual\' or . = \'article (electronic)\' or \r\n    . = \'book\' or . = \'book (electronic)\' or \r\n     . = \'electronicresource\' or . = \'electronic\' or\r\n     . = \'journal (electronic)\' or . = \'journal\' or \r\n     . = \'map (electronic)\' or . = \'map\' or \r\n     . = \'microform\' or . = \'music-score\' or . = \'music-score (electronic)\' or \r\n    . = \'newspaper\' or . = \'newspaper (electronic)\' or\r\n    . = \'recording\' or . = \'recording (electronic)\' or . = \'recording-cd\' or . = \'recording-cassette\' or . = \'recording-vinyl\' or \r\n    . = \'soundrecording\' or \r\n    . = \'thesis (electronic)\' or . = \'thesis\' or\r\n    . = \'video-dvd\' or . = \'video-vhs\' or . = \'video (electronic)\' or . = \'video\' or . = \'videorecording\' or . = \'video\' or . = \'video-blu-ray\'  or\r\n     . = \'web\' or . = \'web (eletronic)\' or\r\n     . = \'realia\' or . = \'picture\' or \r\n     . = \'other\' \r\n    \">\r\n          <xsl:value-of select=\".\"/>\r\n        </xsl:when>\r\n        <!-- Correct some typical differences -->\r\n        <xsl:when test=\". = \'sound recording(dc)\'\"> \r\n            <xsl:text>recording-cd</xsl:text>\r\n        </xsl:when>         \r\n        <xsl:when test=\". = \'videorecording(dvd)\'\">\r\n            <xsl:text>video-dvd</xsl:text>\r\n        </xsl:when>         \r\n        <xsl:when \r\n         test=\". = \'electronic resource\' or . = \'electronisk resours\' \" >\r\n          <xsl:text>electronicresource</xsl:text>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:text>other</xsl:text>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </pz:metadata>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"pz:metadata\"> \r\n    <xsl:copy-of select=\".\" />\r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"text()\" />\r\n</xsl:stylesheet>\r\n','','','','PZ','PZ',NULL),(4057,'XmlTransformationStep','Force Web Media type',NULL,'Web Media type','<?xml version=\"1.0\"?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n   xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\" \r\n    xmlns:tmarc=\"http://www.indexdata.com/turbomarc\">\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\" />\r\n  <xsl:template  match=\"/\">\r\n    <pz:collection>\r\n      <xsl:apply-templates/>\r\n    </pz:collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:record\">\r\n    <pz:record>\r\n      <xsl:apply-templates/>\r\n    </pz:record>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'medium\']\">\r\n    <pz:metadata type=\'medium\'>web</pz:metadata>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"pz:metadata\"> \r\n    <xsl:copy-of select=\".\" />\r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"text()\" />\r\n</xsl:stylesheet>\r\n','','','','PZ','PZ',NULL),(4153,'XmlTransformationStep','Split by well-known delimiters',NULL,'Subject Splitter','<?xml version=\"1.0\"?>\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n\r\n>\r\n  <xsl:output indent=\"yes\" method=\"xml\"/>\r\n\r\n\r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"/collection/pz:record/pz:metadata[@type=\'subject\']\">\r\n    <xsl:for-each select=\"tokenize(.,\'; *|-- *| - |\\. +|, *|\\)|\\(|\\.$\')\">\r\n      <xsl:if test=\"normalize-space(.) != \'\'\">\r\n        <metadata type=\"subject\">\r\n          <xsl:value-of select=\"normalize-space(.)\"/>\r\n        </metadata>\r\n      </xsl:if>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n</xsl:stylesheet>\r\n','','','','PZ','PZ',NULL),(4157,'XmlTransformationStep','Subject 1+2 combined, remove empty  subject-long',NULL,'Extract subject 1+2, remove empty  subject-long','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"1.0\" xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\">\r\n  <xsl:output indent=\"yes\" method=\"xml\"/>\r\n\r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'subject\']\">\r\n    <xsl:call-template name=\"output-tokens\">\r\n       <xsl:with-param name=\"list\">\r\n    <xsl:value-of select=\".\"/>\r\n        </xsl:with-param>\r\n    </xsl:call-template>\r\n  </xsl:template>\r\n\r\n  <!-- remove empty subject-long -->\r\n  <xsl:template match=\"pz:metadata[@type=\'subject-long\']\">\r\n    <xsl:if test=\". and . != \'\' \">\r\n      <pz:metadata type=\"subject-long\">\r\n <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:template name=\"output-tokens\">\r\n    <xsl:param name=\"list\"/>\r\n    <xsl:variable name=\"newlist\" select=\"concat(normalize-space($list), \' -- \')\"/>\r\n    <xsl:variable name=\"first\" select=\"substring-before($newlist, \' -- \')\"/>\r\n    <xsl:variable name=\"remaining\" select=\"substring-after($newlist, \' -- \')\"/>\r\n    <xsl:variable name=\"second\" select=\"substring-before($remaining, \' -- \')\"/>\r\n\r\n    <xsl:if test=\"$first and $first != \'--\'\">\r\n      <pz:metadata type=\'subject\'>\r\n  <xsl:value-of select=\"$first\"/>\r\n <xsl:if test=\"$second and $second != \'--\' \">\r\n    <xsl:text> -- </xsl:text>\r\n   <xsl:value-of select=\"$second\"/>\r\n  </xsl:if>\r\n      </pz:metadata>\r\n    </xsl:if>\r\n  </xsl:template>\r\n</xsl:stylesheet>\r\n','','','','PZ','PZ',NULL),(4159,'XmlTransformationStep','Removing date from Author',NULL,'Author - clean date at end ','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n   xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\">\r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'author\']\">\r\n    <xsl:variable name=\"author\" select=\"replace(string(.), \', [0-9]{4}\\-[0-9]{4}$\', \'\')\" />\r\n    <xsl:if test=\"$author and $author != \'\' \">\r\n      <pz:metadata type=\"author\">\r\n  <xsl:value-of select=\"$author\"/>\r\n      </pz:metadata>\r\n    </xsl:if>\r\n  </xsl:template>\r\n</xsl:stylesheet>','','','','PZ','PZ',NULL),(4402,'XmlTransformationStep','Map to one',NULL,'Anonymous normalization','<?xml version=\"1.0\"?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n   xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\" \r\n    xmlns:tmarc=\"http://www.indexdata.com/turbomarc\">\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\" />\r\n  <xsl:template  match=\"/\">\r\n    <pz:collection>\r\n      <xsl:apply-templates/>\r\n    </pz:collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:record\">\r\n    <pz:record>\r\n      <xsl:apply-templates/>\r\n    </pz:record>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'author\']\">\r\n    <pz:metadata type=\'author\'>\r\n      <xsl:choose>\r\n        <xsl:when \r\n     test=\". = \'ANON\'   or . = \'Anon\'   or . = \'anon\'   or \r\n     . = \'ANON)\'  or . = \'Anon)\'  or . = \'anon)\'  or \r\n    . = \'ANON.)\' or . = \'Anon.)\' or . = \'anon.)\' or\r\n                 . = \'ANON]\'  or . = \'Anon]\'  or . = \'anon]\'  or \r\n    . = \'ANON.]\' or . = \'Anon.]\' or . = \'anon.]\' or \r\n    . = \'Anon.,\' or . = \'anon). / anon\' or\r\n    . = \'ANONYMOUS\' or . = \'anonymous\' or \r\n    . = \'Anonymous (editor)\' or . = \'Anonymous Editor\' or \r\n    . = \'anonymous]\' or . = \'Anonymous]\' or . = \'ANONYMOUS]\' or\r\n     . = \'ANONYMOUS)\' or . = \'Anonymous)\' or  . = \'anonymous)\'  \r\n\r\n     \">\r\n          <xsl:text>Anonymous</xsl:text>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select=\".\"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </pz:metadata>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"pz:metadata\"> \r\n    <xsl:copy-of select=\".\" />\r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"text()\" />\r\n</xsl:stylesheet>\r\n','XSLT','','','PZ','<records xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\">\r\n  <pz:record>\r\n    <pz:metadata type=\"author\">ANON</pz:metadata>\r\n  </pz:record>\r\n</records>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<pz:collection xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\" xmlns:tmarc=\"http://www.indexdata.com/turbomarc\">\r\n<pz:record>\r\n<pz:metadata type=\"author\">Anonymous</pz:metadata>\r\n</pz:record>\r\n</pz:collection>\r\n'),(4403,'XmlTransformationStep','Split a ; delimited list into multiple authors',NULL,'Author split by ;','<?xml version=\"1.0\"?>\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n                xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n                xmlns:tmarc=\"http://www.indexdata.com/turbomarc\">\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\" />\r\n  <xsl:template  match=\"/\">\r\n    <pz:collection>\r\n      <xsl:apply-templates/>\r\n    </pz:collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:record\">\r\n    <pz:record>\r\n      <xsl:apply-templates/>\r\n    </pz:record>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'author\']\">\r\n      <xsl:for-each select=\"tokenize(.,\';\')\">\r\n        <pz:metadata type=\"author\"><xsl:value-of select=\"normalize-space(.)\" /></pz:metadata>\r\n      </xsl:for-each>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata\">\r\n    <xsl:copy-of select=\".\" />\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"text()\" />\r\n</xsl:stylesheet>','XSLT','','','PZ','PZ',NULL),(4404,'XmlTransformationStep','Implement a previous hardcoded rule in pazpar2',NULL,'End Punctuation removal','<?xml version=\"1.0\"?>\r\n<xsl:stylesheet version=\"2.0\" \r\n  xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n  xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\" >\r\n  <xsl:output indent=\"yes\" method=\"xml\"/>\r\n\r\n\r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'subject\']/text()\">\r\n    <xsl:call-template name=\"remove-characters-last\">\r\n      <xsl:with-param  name=\"input\" select=\".\" />\r\n      <xsl:with-param  name=\"characters\">,-.</xsl:with-param>\r\n    </xsl:call-template>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'author\']/text()\">\r\n    <xsl:call-template name=\"remove-characters-last\">\r\n      <xsl:with-param  name=\"input\" select=\".\" />\r\n      <xsl:with-param  name=\"characters\">,-.</xsl:with-param>\r\n    </xsl:call-template>\r\n  </xsl:template>\r\n\r\n\r\n  <xsl:template name=\"remove-characters-last\">\r\n    <xsl:param name=\"input\" />\r\n    <xsl:param name=\"characters\"/>\r\n    <xsl:variable name=\"lastcharacter\" select=\"substring($input,string-length($input))\" />\r\n    <xsl:choose>\r\n      <xsl:when test=\"$characters and $lastcharacter and contains($characters, $lastcharacter)\">\r\n        <xsl:call-template name=\"remove-characters-last\">\r\n          <xsl:with-param  name=\"input\" select=\"substring($input,1, string-length($input)-1)\" />\r\n          <xsl:with-param  name=\"characters\" select=\"$characters\" />\r\n        </xsl:call-template>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:value-of select=\"$input\"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n</xsl:stylesheet>\r\n','XSLT','','','PZ','PZ',NULL),(4405,'XmlTransformationStep','',NULL,'Create ID (if missing)','<xsl:stylesheet version=\"2.0\" \r\n  xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n  xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\" >\r\n  <xsl:output indent=\"yes\" method=\"xml\"/>\r\n\r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:record\"> \r\n    <pz:record>\r\n      <xsl:if test=\"not(pz:metadata[@type=\'id\'])\">\r\n        <pz:metadata type=\"id\">\r\n          <xsl:value-of select=\"pz:metadata[@type=\'author\']\" />\r\n          <xsl:text> - </xsl:text>\r\n          <xsl:value-of select=\"pz:metadata[@type=\'title\']\" />\r\n          <xsl:text> - </xsl:text>\r\n          <xsl:value-of select=\"pz:metadata[@type=\'date\']\" />\r\n        </pz:metadata>\r\n        <xsl:apply-templates />\r\n      </xsl:if>\r\n      <xsl:if test=\"pz:metadata[@type=\'id\']\">\r\n        <xsl:apply-templates />\r\n      </xsl:if>\r\n    </pz:record>\r\n  </xsl:template>\r\n\r\n</xsl:stylesheet>\r\n','XSLT','','','PZ','PZ',NULL),(4406,'XmlTransformationStep','',NULL,'Force Media Type - Book (electronic)','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n   xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n>\r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'medium\']\">\r\n      <pz:metadata type=\"medium\">book (electronic)</pz:metadata>\r\n  </xsl:template>\r\n</xsl:stylesheet>\r\n','XSLT','','','PZ','PZ',NULL),(6704,'XmlTransformationStep','test from jonathan',NULL,'medknow','<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\"\r\n    xmlns:JOURNAL_ARTICLE=\"http://www.medknow.com/dtd\"\r\n    xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n    xmlns:mml=\"http://www.w3.org/1998/Math/MathML\">\r\n\r\n \r\n\r\n  <xsl:output indent=\"yes\"\r\n              method=\"xml\"\r\n              version=\"1.0\"\r\n              encoding=\"UTF-8\"/>\r\n  \r\n  <xsl:template match=\"*/text()[(normalize-space())]\" />\r\n  \r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  \r\n\r\n  <xsl:template name=\"padDatePart\">\r\n    <xsl:param name=\"Input\"/>\r\n    <xsl:choose>\r\n      <xsl:when test=\"string-length($Input) = 2\">\r\n        <xsl:value-of select=\"$Input\"/>\r\n      </xsl:when>\r\n      <xsl:when test=\"string-length($Input) = 1\">\r\n        <xsl:value-of select=\"concat(0,$Input)\"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template name=\"createTimestamp\">\r\n    <xsl:param name=\"Year\"/>\r\n    <xsl:param name=\"Month\"/>\r\n    <xsl:param name=\"Day\"/>\r\n\r\n    <xsl:variable name=\"FxYear\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"$Year\">\r\n          <xsl:value-of select=\"$Year\"/>\r\n        </xsl:when>\r\n        <xsl:otherwise>9999</xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:variable name=\"FxMonth\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"string-length($Month) = 0\">01</xsl:when>\r\n        <xsl:when test=\"$Month\">\r\n          <xsl:value-of select=\"$Month\"/>\r\n        </xsl:when>\r\n\r\n        <xsl:otherwise>01</xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:variable name=\"FxDay\">\r\n      <xsl:choose>\r\n        <xsl:when test=\"string-length($Day) = 0\">01</xsl:when>\r\n        <xsl:when test=\"$Day\">\r\n          <xsl:value-of select=\"$Day\"/>\r\n        </xsl:when>\r\n\r\n        <xsl:otherwise>01</xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:value-of select=\"concat($FxYear,\'-\',$FxMonth,\'-\',$FxDay,\'T23:59:59Z\')\"/>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"JOURNAL_ARTICLE\">\r\n    <pz:collection>\r\n      <xsl:apply-templates/>\r\n    </pz:collection>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match=\"JOURNAL_ARTICLE\">\r\n      <pz:record>\r\n\r\n               \r\n        <xsl:for-each select=\"ARTICLE/DOI\">\r\n          <pz:metadata type=\"electronic-unique-identifier\">DOI:<xsl:value-of select=\".\"/></pz:metadata>\r\n          <pz:metadata type=\"internal-electronic-unique-identifier\">\r\n            <xsl:value-of select=\".\"/>\r\n          </pz:metadata>\r\n          <pz:metadata type=\"id\">medkn:<xsl:value-of select=\".\"/></pz:metadata>\r\n        </xsl:for-each>\r\n\r\n\r\n\r\n        <pz:metadata type=\"allfields\">\r\n          <xsl:value-of select=\"normalize-space(string(.))\"/>\r\n        </pz:metadata>\r\n\r\n        <pz:metadata type=\"description\">\r\n          <xsl:value-of select =\"ARTICLE/ABSTRACT\"/>\r\n        </pz:metadata>\r\n        <xsl:for-each select=\"ARTICLE/AUTHOR_LIST/AUTHOR\">\r\n          <pz:metadata type=\"author\">\r\n            <xsl:value-of select=\"normalize-space(LAST_NAME)\"/>\r\n            <xsl:if test=\"FIRST_NAME\">\r\n              <xsl:value-of select=\"concat(\', \', normalize-space(FIRST_NAME))\"/>\r\n            </xsl:if>\r\n          </pz:metadata>\r\n        </xsl:for-each>\r\n\r\n        <xsl:variable name=\"date-month\">\r\n          <xsl:call-template name=\"padDatePart\">\r\n            <xsl:with-param name=\"Input\" select=\"JOURNAL/PUBLICATION_DETAILS/PUBLICATION_DATE/MONTH\"/>\r\n          </xsl:call-template>\r\n        </xsl:variable>\r\n\r\n        <xsl:variable name=\"date-day\">\r\n          <xsl:call-template name=\"padDatePart\">\r\n            <xsl:with-param name=\"Input\" select=\"JOURNAL/PUBLICATION_DETAILS/PUBLICATION_DATE/DAY\"/>\r\n          </xsl:call-template>\r\n        </xsl:variable>\r\n\r\n        <xsl:variable name=\"datetimestamp\">\r\n          <xsl:call-template name=\"createTimestamp\">\r\n            <xsl:with-param name=\"Year\" select=\"JOURNAL/PUBLICATION_DETAILS/PUBLICATION_DATE/YEAR\"/>\r\n            <xsl:with-param name=\"Month\" select=\"$date-month\"/>\r\n            <xsl:with-param name=\"Day\" select=\"$date-day\"/>\r\n          </xsl:call-template>\r\n        </xsl:variable>\r\n\r\n        <pz:metadata type=\"date-timestamp\">\r\n          <xsl:value-of select=\"$datetimestamp\"/>\r\n        </pz:metadata>\r\n\r\n        <pz:metadata type=\"date-day\">\r\n          <xsl:value-of select=\"$date-day\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"date-month\">\r\n          <xsl:value-of select=\"$date-month\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"date-year\">\r\n          <xsl:value-of select=\"JOURNAL/PUBLICATION_DETAILS/PUBLICATION_DATE/YEAR\"/>\r\n        </pz:metadata>\r\n\r\n        <pz:metadata type=\"date\">\r\n          <xsl:value-of select=\"/JOURNAL/PUBLICATION_DETAILS/PUBLICATION_DATE/YEAR\"/>\r\n          <xsl:if test=\"//PUBLICATION_DATE/MONTH\">\r\n            <xsl:value-of select=\"concat(\'-\',$date-month)\"/>\r\n            <xsl:if test=\"//PUBLICATION_DATE/DAY\">\r\n              <xsl:value-of select=\"concat(\'-\',$date-day)\"/>\r\n            </xsl:if>\r\n          </xsl:if>\r\n        </pz:metadata>\r\n\r\n        <!-->xsl:for-each select=\"//ARTICLE/DOI\">\r\n          <pz:metadata type=\"electronic-unique-identifier\">\r\n            <xsl:value-of select=\"concat(\'DOI:\',.)\"/>\r\n          </pz:metadata>\r\n          <pz:metadata type=\"internal-electronic-unique-identifier\">\r\n            <xsl:value-of select=\".\"/>\r\n          </pz:metadata>\r\n          \r\n        </xsl:for-each-->\r\n\r\n        <pz:metadata type=\"item-URL\">\r\n          <xsl:value-of select=\"ARTICLE/SUMMARY_URL\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"journal-name\">\r\n          <xsl:value-of select=\"JOURNAL/JOURNAL_TITLE\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"journal-start-page\">\r\n          <xsl:value-of select=\"ARTICLE/FIRST_PAGE\"/>\r\n        </pz:metadata>\r\n        <xsl:if test=\"ARTICLE/FIRST_PAGE and ARTICLE/LAST_PAGES\">\r\n          <pz:metadata type=\"journal-pages\">\r\n            <xsl:value-of select=\"concat(ARTICLE/FIRST_PAGE,\'-\', ARTICLE/LAST_PAGE)\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <pz:metadata type=\"journal-volume\">\r\n          <xsl:value-of select=\"JOURNAL/PUBLICATION_DETAILS/VOLUME\"/>\r\n        </pz:metadata>\r\n        <pz:metadata type=\"journal-issue\">\r\n          <xsl:value-of select=\"JOURNAL/PUBLICATION_DETAILS/ISSUE\"/>\r\n        </pz:metadata>\r\n\r\n        <xsl:if test=\"//EISSN and string-length(//EISSN) != 0\">\r\n          <pz:metadata type=\"online-identifier\">\r\n            <xsl:value-of select=\"concat(\'EISSN:\', //EISSN)\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <xsl:if test=\"//ISSN and string-length(//ISSN) != 0\">\r\n          <pz:metadata type=\"online-identifier\">\r\n            <xsl:value-of select=\"concat(\'ISSN:\', //ISSN)\"/>\r\n          </pz:metadata>\r\n        </xsl:if>\r\n        <pz:metadata type=\"publication-format\">Online</pz:metadata>\r\n        <pz:metadata type=\"publication-document-type\">Article</pz:metadata>\r\n        <pz:metadata type=\"publisher-name\">\r\n          <xsl:value-of select=\"//PUBLISHER_NAME\"/>\r\n        </pz:metadata>\r\n\r\n        <xsl:for-each select=\"//KEYWORDS/KEYWORD\">\r\n          <pz:metadata type=\"subject\">\r\n            <xsl:value-of select=\".\"/>\r\n          </pz:metadata>\r\n        </xsl:for-each>\r\n\r\n        <pz:metadata type=\"title\">\r\n          <xsl:value-of select=\"//ARTICLE_TITLE\"/>\r\n        </pz:metadata>\r\n\r\n      </pz:record>\r\n\r\n  </xsl:template>\r\n  <xsl:template match=\"text()\"/>\r\n  \r\n</xsl:stylesheet>',NULL,'','',NULL,'',''),(8103,'XmlTransformationStep','mkh-439',NULL,'mkh-439','<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n  xmlns:dtyf=\"http://www.datypic.com/functions\"\r\n  xpath-default-namespace=\"http://www.datypic.com/books/ns\">\r\n\r\n  <xsl:output method=\"html\"/>\r\n\r\n  <xsl:template match=\"books\">\r\n    <html>\r\n      <body>\r\n        <table border=\"1\">\r\n          <xsl:apply-templates/>\r\n        </table>\r\n      </body>\r\n    </html>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"book\">\r\n    <tr>\r\n      <td><xsl:value-of select=\"title\"/></td>\r\n      <td><xsl:value-of select=\"dtyf:format-person-name(author/person)\"/></td>\r\n      <td><xsl:value-of select=\"price\"/></td>\r\n    </tr>\r\n  </xsl:template>\r\n\r\n  <xsl:function name=\"dtyf:format-person-name\">\r\n    <xsl:param name=\"person\"/>\r\n    <xsl:value-of select=\"$person/last\"/>\r\n    <xsl:text>, </xsl:text>\r\n    <xsl:value-of select=\"$person/first\"/>\r\n  </xsl:function>\r\n</xsl:stylesheet>',NULL,'','',NULL,'<books xmlns=\"http://www.datypic.com/books/ns\">\r\n  <book>\r\n    <title>The East-West House: Noguchi\'s Childhood in Japan</title>\r\n    <author>\r\n      <person>\r\n        <first>Christy</first>\r\n        <last>Hale</last>\r\n      </person>\r\n    </author>\r\n    <price>9.95</price>\r\n    <discount>1.95</discount>\r\n  </book>\r\n  <book>\r\n    <title>Buckminster Fuller and Isamu Noguchi: Best of Friends</title>\r\n    <author>\r\n      <person>\r\n        <first>Shoji</first>\r\n        <last>Sadao</last>\r\n      </person>\r\n    </author>\r\n    <price>65.00</price>\r\n    <discount>5.00</discount>\r\n  </book>\r\n</books>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<cities>\r\n<city name=\"milan\" country=\"italy\" pop=\"5\"/>\r\n<city name=\"paris\" country=\"france\" pop=\"7\"/>\r\n<city name=\"munich\" country=\"germany\" pop=\"4\"/>\r\n<city name=\"lyon\" country=\"france\" pop=\"2\"/>\r\n<city name=\"venice\" country=\"italy\" pop=\"1\"/>\r\n</cities>\r\n'),(8107,'CustomTransformationStep','mkh-439-log',NULL,'mkh-439-log','{\r\n \"indent\": \"true\"\r\n}',NULL,'','','com.indexdata.masterkey.localindices.harvest.messaging.XmlLoggerRouter','',''),(8155,'XmlTransformationStep','xsl 2.0 test',NULL,'MKH-436','<xsl:transform \r\n  xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n  xmlns:str=\"http://user.com/namespace\"\r\n  version=\"2.0\"\r\n  exclude-result-prefixes=\"str\">\r\n\r\n<xsl:function name=\"str:reverse\">\r\n  <xsl:param name=\"sentence\"/>\r\n  <xsl:result \r\n     select=\"if (contains($sentence, \' \'))\r\n             then concat(str:reverse(substring-after($sentence, \' \')),\r\n                         \' \',\r\n                         substring-before($sentence, \' \'))\r\n             else $sentence\"/>             \r\n</xsl:function>\r\n\r\n<xsl:template match=\"/\">\r\n<output>\r\n  <xsl:value-of select=\"str:reverse(\'DOG BITES MAN\')\"/>\r\n</output>\r\n</xsl:template>\r\n\r\n</xsl:transform>',NULL,'','',NULL,'<cities>\r\n  <city name=\"milan\"  country=\"italy\"   pop=\"5\"/>\r\n  <city name=\"paris\"  country=\"france\"  pop=\"7\"/>\r\n  <city name=\"munich\" country=\"germany\" pop=\"4\"/>\r\n  <city name=\"lyon\"   country=\"france\"  pop=\"2\"/>\r\n  <city name=\"venice\" country=\"italy\"   pop=\"1\"/>\r\n</cities>',''),(8202,'XmlTransformationStep','xsl 2.0 test 2',NULL,'MKH436','<?xml version=\"1.0\"?>\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\" />\r\n<xsl:template match=\"files\">\r\n\r\n  <xsl:for-each-group select=\"file\" group-by=\"@project\">\r\n    \r\n    <xsl:for-each select=\"current-group()\">\r\n      <xsl:value-of select=\"@name\"/>, <xsl:value-of select=\"@size\"/>\r\n      <xsl:text>\r\n</xsl:text>\r\n    </xsl:for-each>\r\n\r\n    <xsl:text>average size for </xsl:text>\r\n    <xsl:value-of select=\"current-grouping-key()\"/>\r\n    <xsl:text> group: </xsl:text>\r\n    <xsl:value-of select=\"avg(current-group()/@size)\"/>\r\n    <xsl:text>\r\n\r\n</xsl:text>\r\n  </xsl:for-each-group>\r\n\r\n</xsl:template></xsl:stylesheet>\r\n',NULL,'','',NULL,'<files>\r\n  <file name=\"swablr.eps\"     size=\"4313\" project=\"mars\"/>\r\n  <file name=\"batboy.wks\"     size=\"424\"  project=\"neptune\"/>\r\n  <file name=\"potrzebie.dbf\"  size=\"1102\" project=\"jupiter\"/>\r\n  <file name=\"kwatz.xom\"      size=\"43\"   project=\"jupiter\"/>\r\n  <file name=\"paisley.doc\"    size=\"988\"  project=\"neptune\"/>\r\n  <file name=\"ummagumma.zip\"  size=\"2441\" project=\"mars\"/>\r\n  <file name=\"schtroumpf.txt\" size=\"389\"  project=\"mars\"/>\r\n  <file name=\"mondegreen.doc\" size=\"1993\" project=\"neptune\"/>\r\n  <file name=\"gadabout.pas\"   size=\"685\"  project=\"jupiter\"/>\r\n</files>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>swablr.eps, 4313\nummagumma.zip, 2441\nschtroumpf.txt, 389\naverage size for mars group: 2381\n\nbatboy.wks, 424\npaisley.doc, 988\nmondegreen.doc, 1993\naverage size for neptune group: 1135\n\npotrzebie.dbf, 1102\nkwatz.xom, 43\ngadabout.pas, 685\naverage size for jupiter group: 610\n\n'),(8752,'XmlTransformationStep','',NULL,'url to electronic-url','<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n   xmlns:pz=\"http://www.indexdata.com/pazpar2/1.0\">\r\n\r\n  <xsl:template match=\"@* | node()\">\r\n    <xsl:copy>\r\n      <xsl:apply-templates select=\"@* | node()\"/>\r\n    </xsl:copy>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"pz:metadata[@type=\'url\']\">\r\n     <pz:metadata type=\"id\">\r\n              <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n     <pz:metadata type=\"electronic-url\">\r\n              <xsl:value-of select=\".\"/>\r\n      </pz:metadata>\r\n  </xsl:template>\r\n\r\n</xsl:stylesheet>\r\n',NULL,'PZ','PZ',NULL,'',''),(9130,'CustomTransformationStep','PZ to FOLIO Instance JSON',1,'PZ to Instance',NULL,'custom','JSON','XML','com.indexdata.masterkey.localindices.harvest.messaging.Pz2XmlToInstanceJsonTransformerRouter',NULL,NULL),(9131,'CustomTransformationStep','FOLIO Instance XML to JSON',1,'Instance XML to JSON','','custom','JSON','XML','com.indexdata.masterkey.localindices.harvest.messaging.InstanceXmlToInstanceJsonTransformerRouter','',''),(10002,'XmlTransformationStep','MARC21 XML to FOLIO Instance XML',NULL,'MARC21 to Instance XML','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet\r\n    version=\"1.0\"\r\n    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n    xmlns:marc=\"http://www.loc.gov/MARC21/slim\">\r\n\r\n  <xsl:import href=\"map-relator-to-contributor-type.xsl\"/>\r\n\r\n  <xsl:output indent=\"yes\" method=\"xml\" version=\"1.0\" encoding=\"UTF-8\"/>\r\n\r\n<!-- Extract metadata from MARC21/USMARC\r\n      http://www.loc.gov/marc/bibliographic/ecbdhome.html\r\n-->\r\n\r\n  <xsl:template match=\"/\">\r\n    <collection>\r\n      <xsl:apply-templates />\r\n    </collection>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"//delete\">\r\n     <xsl:copy-of select=\".\"/>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"//marc:record\">\r\n\r\n    <record>\r\n      <instanceTypeId>\r\n        <!-- UUIDs for resource types -->\r\n        <xsl:choose>\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'a\'\">6312d172-f0cf-40f6-b27d-9fa8feaf332f</xsl:when> <!-- language material : text -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'c\'\">497b5090-3da2-486c-b57f-de5bb3c2e26d</xsl:when> <!-- notated music : notated music -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'d\'\">497b5090-3da2-486c-b57f-de5bb3c2e26d</xsl:when> <!-- manuscript notated music : notated music -> notated music -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'e\'\">526aa04d-9289-4511-8866-349299592c18</xsl:when> <!-- cartographic material : cartographic image -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'f\'\"></xsl:when>                                     <!-- manuscript cartographic material : ? -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'g\'\">535e3160-763a-42f9-b0c0-d8ed7df6e2a2</xsl:when> <!-- projected image : still image -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'i\'\">9bce18bd-45bf-4949-8fa8-63163e4b7d7f</xsl:when> <!-- nonmusical sound recording : sounds -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'j\'\">3be24c14-3551-4180-9292-26a786649c8b</xsl:when> <!-- musical sound recording : performed music -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'k\'\"></xsl:when>                                     <!-- two-dimensional nonprojectable graphic : ?-->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'m\'\">df5dddff-9c30-4507-8b82-119ff972d4d7</xsl:when> <!-- computer file : computer dataset -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'o\'\">a2c91e87-6bab-44d6-8adb-1fd02481fc4f</xsl:when> <!-- kit : other -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'p\'\">a2c91e87-6bab-44d6-8adb-1fd02481fc4f</xsl:when> <!-- mixed material : other -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'r\'\">c1e95c2b-4efc-48cf-9e71-edb622cf0c22</xsl:when> <!-- three-dimensional artifact or naturally occurring object : three-dimensional form -->\r\n          <xsl:when test=\"substring(marc:leader,7,1)=\'t\'\">6312d172-f0cf-40f6-b27d-9fa8feaf332f</xsl:when> <!-- manuscript language material : text -->\r\n          <xsl:otherwise>a2c91e87-6bab-44d6-8adb-1fd02481fc4f</xsl:otherwise>                             <!--  : other -->\r\n        </xsl:choose>\r\n      </instanceTypeId>\r\n\r\n      <source>HARVEST</source>\r\n\r\n      <xsl:for-each select=\"marc:datafield[@tag=\'245\']\">\r\n        <title>\r\n          <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n        </title>\r\n      </xsl:for-each>\r\n      <xsl:if test=\"marc:datafield[@tag=\'100\' or @tag=\'110\' or @tag=\'111\' or @tag=\'700\' or @tag=\'710\' or @tag=\'711\']\">\r\n        <contributors>\r\n          <arr>\r\n            <xsl:for-each select=\"marc:datafield[@tag=\'100\' or @tag=\'110\' or @tag=\'111\' or @tag=\'700\' or @tag=\'710\' or @tag=\'711\']\">\r\n              <i>\r\n                <name>\r\n                <xsl:for-each select=\"marc:subfield[@code=\'a\' or @code=\'b\' or @code=\'c\' or @code=\'d\' or @code=\'f\' or @code=\'g\' or @code=\'j\' or @code=\'k\' or @code=\'l\' or @code=\'n\' or @code=\'p\' or @code=\'q\' or @code=\'t\' or @code=\'u\']\">\r\n                  <xsl:if test=\"position() > 1\">\r\n                    <xsl:text>; </xsl:text>\r\n                  </xsl:if>\r\n                  <xsl:value-of select=\".\"/>\r\n                </xsl:for-each>\r\n                </name>\r\n                <xsl:choose>\r\n                  <xsl:when test=\"@tag=\'100\' or @tag=\'700\'\">\r\n                    <contributorNameTypeId>2b94c631-fca9-4892-a730-03ee529ffe2a</contributorNameTypeId> <!-- personal name -->\r\n                  </xsl:when>\r\n                  <xsl:when test=\"@tag=\'110\' or @tag=\'710\'\">\r\n                    <contributorNameTypeId>2e48e713-17f3-4c13-a9f8-23845bb210aa</contributorNameTypeId> <!-- corporate name -->\r\n                  </xsl:when>\r\n                  <xsl:when test=\"@tag=\'111\' or @tage=\'711\'\">\r\n                    <contributorNameTypeId>e8b311a6-3b21-43f2-a269-dd9310cb2d0a</contributorNameTypeId> <!-- meeting name -->\r\n                  </xsl:when>\r\n                </xsl:choose>\r\n                <xsl:if test=\"marc:subfield[@code=\'e\' or @code=\'4\']\">\r\n                  <contributorTypeId>\r\n                    <xsl:call-template name=\"map-relator\"/>\r\n                  </contributorTypeId>\r\n                </xsl:if>\r\n              </i>\r\n            </xsl:for-each>\r\n          </arr>\r\n        </contributors>\r\n      </xsl:if>\r\n      <xsl:if test=\"marc:datafield[@tag=\'250\']\">\r\n        <editions>\r\n          <arr>\r\n          <xsl:for-each select=\"marc:datafield[@tag=\'250\']\">\r\n            <i>\r\n              <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n              <xsl:if test=\"marc:subfield[@code=\'b\']\">; <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/></xsl:if>\r\n            </i>\r\n          </xsl:for-each>\r\n          </arr>\r\n        </editions>\r\n      </xsl:if>\r\n      <xsl:if test=\"marc:datafield[@tag=\'260\']\">\r\n        <publication>\r\n          <arr>\r\n            <xsl:for-each select=\"marc:datafield[@tag=\'260\']\">\r\n              <i>\r\n                <publisher>\r\n                  <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n                </publisher>\r\n                <place>\r\n                  <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n                </place>\r\n                <dateOfPublication>\r\n                  <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n                </dateOfPublication>\r\n              </i>\r\n            </xsl:for-each>\r\n          </arr>\r\n        </publication>\r\n      </xsl:if>\r\n      <xsl:if test=\"marc:datafield[@tag=\'264\']\">\r\n        <publication>\r\n          <arr>\r\n            <xsl:for-each select=\"marc:datafield[@tag=\'264\']\">\r\n              <i>\r\n                <publisher>\r\n                  <xsl:value-of select=\"marc:subfield[@code=\'b\']\"/>\r\n                </publisher>\r\n                <place>\r\n                  <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n                </place>\r\n                <dateOfPublication>\r\n                  <xsl:value-of select=\"marc:subfield[@code=\'c\']\"/>\r\n                </dateOfPublication>\r\n              </i>\r\n            </xsl:for-each>\r\n          </arr>\r\n        </publication>\r\n      </xsl:if>\r\n\r\n      <xsl:if test=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n        <subjects>\r\n          <arr>\r\n          <xsl:for-each select=\"marc:datafield[@tag=\'600\' or @tag=\'610\' or @tag=\'611\' or @tag=\'630\' or @tag=\'648\' or @tag=\'650\' or @tag=\'651\' or @tag=\'653\' or @tag=\'654\' or @tag=\'655\' or @tag=\'656\' or @tag=\'657\' or @tag=\'658\' or @tag=\'662\' or @tag=\'69X\']\">\r\n            <i>\r\n              <xsl:value-of select=\"marc:subfield[@code=\'a\']\"/>\r\n            </i>\r\n          </xsl:for-each>\r\n          </arr>\r\n        </subjects>\r\n      </xsl:if>\r\n    </record>\r\n  </xsl:template>\r\n\r\n  <xsl:template match=\"text()\"/>\r\n</xsl:stylesheet>\r\n',NULL,'XML','XML',NULL,'','');
/*!40000 ALTER TABLE `STEP` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `STORAGE`
--

DROP TABLE IF EXISTS `STORAGE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `STORAGE` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `CURRENTSTATUS` varchar(4096) DEFAULT NULL,
  `NAME` varchar(255) DEFAULT NULL,
  `MESSAGE` varchar(4096) DEFAULT NULL,
  `TRANSFORMATION` varchar(100) DEFAULT NULL,
  `DESCRIPTION` varchar(4096) DEFAULT NULL,
  `URL` varchar(255) DEFAULT NULL,
  `CUSTOMCLASS` varchar(1024) DEFAULT NULL,
  `LOGLEVEL` varchar(30) DEFAULT NULL,
  `MAILLEVEL` varchar(30) DEFAULT NULL,
  `MAILADDRESS` varchar(1000) DEFAULT NULL,
  `BULKSIZE` bigint(20) DEFAULT '1000',
  `TIMEOUT` smallint(4) DEFAULT NULL,
  `RETRYCOUNT` tinyint(3) DEFAULT NULL,
  `RETRYWAIT` smallint(4) DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `STORAGE` WRITE;
/*!40000 ALTER TABLE `STORAGE` DISABLE KEYS */;
INSERT INTO `STORAGE` VALUES (103,'SolrStorageEntity',1,'TODO','Solr @ localhost',NULL,NULL,'Solr at localhost:8983','http://localhost:8983/solr/lui/',NULL,NULL,NULL,NULL,1000,60,2,60);
INSERT INTO `STORAGE` VALUES (104,'InventoryStorageEntity',1,'TODO','FOLIO Inventory Storage @ localhost',NULL,NULL,'Inventory Storage at localhost','http://10.0.2.2:9130/instance-storage/instances',NULL,NULL,NULL,NULL,1000,60,2,60);
INSERT INTO `STORAGE` VALUES (105,'InventoryStorageEntity',1,'TODO','FOLIO Inventory Match @ localhost',NULL,NULL,'Inventory Match at localhost','http://10.0.2.2:9130/instance-storage-match/instances',NULL,NULL,NULL,NULL,1000,60,2,60);
/*!40000 ALTER TABLE `STORAGE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `TRANSFORMATION`
--

DROP TABLE IF EXISTS `TRANSFORMATION`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `TRANSFORMATION` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `DESCRIPTION` varchar(4096) DEFAULT NULL,
  `ENABLED` tinyint(1) DEFAULT '0',
  `NAME` varchar(255) DEFAULT NULL,
  `PARALLEL` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `TRANSFORMATION` WRITE;
/*!40000 ALTER TABLE `TRANSFORMATION` DISABLE KEYS */;
INSERT INTO `TRANSFORMATION` VALUES
 (  10,'BasicTransformation','Converting from OAI-PMH(DC) to PZ',1,'OAI-PMH(DC) to PZ (medium book)',NULL),
 (  20,'BasicTransformation','Converting from OAI-PMH(MARCXML) to PZ',1,'OAI-PMH(MARCXML) to PZ',NULL),
 (2953,'BasicTransformation','',1,'Marc XML',NULL),
 (2954,'BasicTransformation','Converts from Turbo Marc XML to PZ',1,'Turbo Marc',NULL),
 (3102,'BasicTransformation','Gutenberg to MARC21, MARC21 to PZ2, Subject split (retain level 1 and 2). Clean out empty subject-longs',1,'Gutenberg (Subject level 1 and 2)',NULL),
 (3103,'BasicTransformation','',1,'DC to MARC21 (slim)',NULL),
 (3603,'BasicTransformation','',1,'Wikipedia Abstract 2 PZ',NULL),
 (4002,'BasicTransformation','Marc XML 2 PZ',1,'Marc XML 2 PZ (full)',NULL),
 (4202,'BasicTransformation','',1,'Gutenberg (PZ)',NULL),
 (4702,'BasicTransformation','adsasd',0,'Test 1',NULL),
 (4802,'BasicTransformation','sdfadad',0,'Test 2',0),
 (5052,'BasicTransformation','',1,'TurboMarc with identifier fix',NULL),
 (5203,'BasicTransformation','',1,'OAI-PMH(DC) to PZ, simple',NULL),
 (6703,'BasicTransformation','test from jonathan',1,'medknow',0),
 (8118,'BasicTransformation','MKH-439',0,'MKH-439',0),
 (8152,'BasicTransformation','test xslt 2.0',1,'MKH-436',0),
 (8753,'BasicTransformation','',1,'Connector to PZ',0);

INSERT INTO `TRANSFORMATION` VALUES
(9130, 'BasicTransformation','OAI-PMH(DC) to FOLIO Instance JSON via PZ',1,'OAI-PMH(DC) to Instance JSON',NULL);
INSERT INTO `TRANSFORMATION` VALUES
(9131, 'BasicTransformation','OAI-PMH MARC21 to FOLIO Instance JSON',1,'OAI-PMH MARC21 to Instance JSON',NULL);
/*!40000 ALTER TABLE `TRANSFORMATION` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `TRANSFORMATION_STEP`
--

DROP TABLE IF EXISTS `TRANSFORMATION_STEP`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `TRANSFORMATION_STEP` (
  `ID` bigint(20) NOT NULL,
  `DTYPE` varchar(31) DEFAULT NULL,
  `POSITION` int(11) DEFAULT NULL,
  `TRANSFORMATION_ID` bigint(20) NOT NULL,
  `STEP_ID` bigint(20) NOT NULL,
  PRIMARY KEY (`ID`),
  KEY `FK_TRANSFORMATION_STEP_STEP_ID` (`STEP_ID`),
  KEY `TRANSFORMATION_STEP_TRANSFORMATION_ID` (`TRANSFORMATION_ID`),
  CONSTRAINT `FK_TRANSFORMATION_STEP_STEP_ID` FOREIGN KEY (`STEP_ID`) REFERENCES `step` (`ID`),
  CONSTRAINT `FK_TRANSFORMATION_STEP_TRANSFORMATION_ID` FOREIGN KEY (`TRANSFORMATION_ID`) REFERENCES `TRANSFORMATION` (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

LOCK TABLES `TRANSFORMATION_STEP` WRITE;
/*!40000 ALTER TABLE `TRANSFORMATION_STEP` DISABLE KEYS */;
INSERT INTO `TRANSFORMATION_STEP`
VALUES (1,'TransformationStepAssociation',1,10,10),
       (2,'TransformationStepAssociation',1,20,20),
       (3,'TransformationStepAssociation',2,20,22),
       (3002,'TransformationStepAssociation',1,2953,22),
       (3004,'TransformationStepAssociation',1,2954,3005),
       (3152,'TransformationStepAssociation',1,3102,3153),
       (3154,'TransformationStepAssociation',1,3103,3155),
       (3652,'TransformationStepAssociation',1,3603,3653),
       (4052,'TransformationStepAssociation',1,4002,4053),
       (4054,'TransformationStepAssociation',2,10,4055),
       (4056,'TransformationStepAssociation',2,3603,4057),
       (4156,'TransformationStepAssociation',4,3102,4157),
       (4158,'TransformationStepAssociation',5,3102,4159),
       (4352,'TransformationStepAssociation',4,20,4055),
       (4355,'TransformationStepAssociation',2,4202,4157),
       (4357,'TransformationStepAssociation',3,2953,4055),
       (4358,'TransformationStepAssociation',2,3102,22),
       (4452,'TransformationStepAssociation',4,2953,4402),
       (4454,'TransformationStepAssociation',6,2953,4405),
       (4455,'TransformationStepAssociation',6,2953,4404),
       (4456,'TransformationStepAssociation',3,2953,4403),
       (4457,'TransformationStepAssociation',3,4202,4406),
       (4458,'TransformationStepAssociation',4,4202,4402),
       (4459,'TransformationStepAssociation',5,3102,4055),
       (4461,'TransformationStepAssociation',6,3102,4402),
       (4462,'TransformationStepAssociation',3,10,4402),
       (4463,'TransformationStepAssociation',4,10,4159),
       (4464,'TransformationStepAssociation',4,20,4402),
       (4465,'TransformationStepAssociation',5,20,4159),
       (4657,'TransformationStepAssociation',5,10,4157),
       (4658,'TransformationStepAssociation',6,10,4406),
       (4752,'TransformationStepAssociation',1,4702,3153),
       (4753,'TransformationStepAssociation',2,4702,22),
       (4754,'TransformationStepAssociation',3,4702,4055),
       (4755,'TransformationStepAssociation',4,4702,4402),
       (4756,'TransformationStepAssociation',5,4702,4159),
       (4757,'TransformationStepAssociation',1,4802,3155),
       (4758,'TransformationStepAssociation',2,4802,22),
       (4759,'TransformationStepAssociation',3,4802,4055),
       (4760,'TransformationStepAssociation',6,4802,4402),
       (4762,'TransformationStepAssociation',5,4802,4159),
       (4763,'TransformationStepAssociation',4,4802,4403),
       (5102,'TransformationStepAssociation',1,5052,3005),
       (5103,'TransformationStepAssociation',2,5052,4405),
       (5252,'TransformationStepAssociation',1,5203,10),
       (5253,'TransformationStepAssociation',3,5203,4402),
       (5254,'TransformationStepAssociation',4,5203,4159),
       (5255,'TransformationStepAssociation',2,5203,4055),
       (6705,'TransformationStepAssociation',1,6703,6704),
       (8119,'TransformationStepAssociation',3,8118,3003),
       (8154,'TransformationStepAssociation',1,8152,8107),
       (8352,'TransformationStepAssociation',6,8118,8103),
       (8502,'TransformationStepAssociation',2,8118,8107),
       (8553,'TransformationStepAssociation',3,8118,4053),
       (8754,'TransformationStepAssociation',1,8753,8752);

-- Pipeline for creating instance JSON from OAI-PMH DC
INSERT INTO `TRANSFORMATION_STEP` VALUES
   (9131,'TransformationStepAssociation',1,9130,10),
   (9132,'TransformationStepAssociation',2,9130,4055),
   (9133,'TransformationStepAssociation',3,9130,9130);

-- Pipeline for creating instance JSON from OAI-PMH MARC21
INSERT INTO `TRANSFORMATION_STEP` VALUES
   (9135,'TransformationStepAssociation',1,9131,10002),
   (9134,'TransformationStepAssociation',2,9131,9131);

/*!40000 ALTER TABLE `TRANSFORMATION_STEP` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;


/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2015-06-22 13:30:28
-- Sample data added from new dump on 2016-05-01, except for data for STORAGE, which were taken from NE's local dev.
-- Cleaned up 2016-05-05 to remove HARVESTABLES data, point storage to localhost:8080/solr4 (ws)
-- 2017-07-21 Point storage to localhost:8983/solr/lui (ws)
